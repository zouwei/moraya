# v0.16.0 æ’ä»¶ç³»ç»Ÿ

**ç‰ˆæœ¬ï¼š** v0.16.0
**çŠ¶æ€ï¼š** å·²å®Œæˆ
**æ—¥æœŸï¼š** 2026-02-26

---

## èƒŒæ™¯ä¸ç›®æ ‡

Moraya ç°é˜¶æ®µçš„åŠŸèƒ½ï¼ˆAI å¯¹è¯ã€è¯­éŸ³è½¬å½•ã€AI ç”Ÿå›¾ã€Markdown ç¼–è¾‘ï¼‰å·²å½¢æˆå®Œæ•´é—­ç¯ï¼Œä½†æ‰€æœ‰åŠŸèƒ½å‡ç¡¬ç¼–ç åœ¨ä¸»åŒ…ä¸­ã€‚éšç€ç”¨æˆ·éœ€æ±‚å¤šæ ·åŒ–ï¼Œä»¥ä¸‹çŸ›ç›¾æ—¥ç›Šå‡¸æ˜¾ï¼š

- **åŒ…ä½“ç§¯ vs åŠŸèƒ½å®Œæ•´**ï¼šå£°çº¹åˆ†ç¦»ï¼ˆ~150MB ML æ¨¡å‹ï¼‰ã€PDF å¯¼å…¥ã€LaTeX å¢å¼ºç­‰é‡å‹åŠŸèƒ½ä¸é€‚åˆå†…ç½®ï¼Œä½†æœ‰çœŸå®éœ€æ±‚
- **é•¿å°¾éœ€æ±‚æ— æ³•æ»¡è¶³**ï¼šä¸åŒç”¨æˆ·çš„å·¥ä½œæµå·®å¼‚å·¨å¤§ï¼Œæ ¸å¿ƒå›¢é˜Ÿæ— æ³•é€ä¸€å®ç°
- **ç”Ÿæ€ç«äº‰åŠ›**ï¼šObsidian çš„æ’ä»¶ç”Ÿæ€æ˜¯å…¶æœ€å¤§æŠ¤åŸæ²³ï¼ŒMoraya éœ€è¦åœ¨ AI æ—¶ä»£å»ºç«‹åŒç±»å®šä½

v0.16.0 å¼•å…¥**å¼€æ”¾æ’ä»¶ç³»ç»Ÿ**ï¼Œè®©ç¬¬ä¸‰æ–¹å¼€å‘è€…å¯ä»¥é€šè¿‡æ ‡å‡†åŒ–åè®®æ‰©å±• Moraya çš„ä»»æ„èƒ½åŠ›ï¼ŒåŒæ—¶å¼•å…¥**å»ä¸­å¿ƒåŒ–æ’ä»¶å¸‚åœº**ï¼Œä½¿æ’ä»¶å‘ç°ã€å®‰è£…ã€æ›´æ–°å…¨æµç¨‹åœ¨ Moraya å†…å®Œæˆã€‚

**æ ¸å¿ƒçº¦æŸ**ï¼š
- ä¸»åŒ…ä½“ç§¯ä¸å¢åŠ ï¼ˆæ’ä»¶ç³»ç»Ÿæœ¬èº« Rust + TS ä»£ç  <30KBï¼‰
- ä¸å¼•å…¥ä»»ä½•æ–°çš„å¤–éƒ¨ä¾èµ–ï¼ˆå¤ç”¨å·²æœ‰ MCP sidecar è¿›ç¨‹åŸºç¡€è®¾æ–½ï¼‰
- å®‰å…¨ä¼˜å…ˆï¼šé˜²æ­¢ä¾›åº”é“¾æ”»å‡»ï¼Œæœ€å°åŒ–æ¶æ„æ’ä»¶çš„çˆ†ç‚¸åŠå¾„

---

## æ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Moraya ä¸»è¿›ç¨‹                                              â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Frontend (Svelte)                                   â”‚  â”‚
â”‚  â”‚  PluginsPanel  â†â†’  plugin-manager.ts (store)         â”‚  â”‚
â”‚  â”‚  PluginMarket  â†â†’  Tauri IPC                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚ invoke()                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Rust Backend                                        â”‚  â”‚
â”‚  â”‚  plugin_manager.rs  (PluginProcessManager)           â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ plugin_install_local / plugin_install_from_url  â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ plugin_enable / plugin_disable / plugin_uninstallâ”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ plugin_list / plugin_registry_fetch             â”‚  â”‚
â”‚  â”‚  â””â”€â”€ plugin_invoke (JSON-RPC proxy)                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚ stdio JSON-RPC                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Plugin Processï¼ˆç‹¬ç«‹ç³»ç»Ÿè¿›ç¨‹ï¼‰                       â”‚  â”‚
â”‚  â”‚  å—æ§é€šä¿¡ï¼šåªèƒ½é€šè¿‡ Moraya Plugin API æ“ä½œä¸»ç¨‹åº      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ä¸ MCP çš„å…³ç³»**ï¼š

| | MCPï¼ˆå·²æœ‰ï¼‰| æ’ä»¶ç³»ç»Ÿï¼ˆæ–°å¢ï¼‰|
|--|-----------|------------|
| ç”¨é€” | AI å·¥å…·è°ƒç”¨ | ç¼–è¾‘å™¨/AI åŠŸèƒ½æ‰©å±• |
| åè®® | MCP è§„èŒƒ JSON-RPC | Moraya Plugin JSON-RPC |
| è¿›ç¨‹ç®¡ç† | MCPProcessManager | PluginProcessManagerï¼ˆfork è‡ª MCPï¼‰|
| æ³¨å†Œæ–¹å¼ | ç”¨æˆ·æ‰‹åŠ¨é…ç½® | GitHub æ³¨å†Œè¡¨ + å¸‚åœº UI |
| å®‰å…¨æ¨¡å‹ | ç”¨æˆ·ä¿¡ä»»é“¾ | SHA256 ç‰ˆæœ¬é”å®š + æƒé™å£°æ˜ |

---

## F1ï¼šæ’ä»¶ Manifest è§„èŒƒï¼ˆplugin.jsonï¼‰

æ¯ä¸ªæ’ä»¶çš„æ ¹ç›®å½•å¿…é¡»åŒ…å« `plugin.json`ï¼Œæ˜¯æ’ä»¶ç³»ç»Ÿä¸€åˆ‡è¡Œä¸ºçš„ä¾æ®ã€‚

### å®Œæ•´æ ¼å¼

```json
{
  "id": "moraya-meeting-assistant",
  "name": "ä¼šè®®åŠ©æ‰‹",
  "version": "0.2.1",
  "description": "å®æ—¶è½¬å½• + AI æ‘˜è¦ + å¾…åŠæå–ï¼Œä¼šè®®è®°å½•åˆ©å™¨",
  "author": "Moraya Team",
  "license": "Apache-2.0",
  "apiVersion": "1",
  "entry": {
    "darwin-aarch64": "bin/plugin-macos-arm64",
    "darwin-x86_64":  "bin/plugin-macos-x64",
    "win32":          "bin/plugin.exe",
    "linux-x86_64":   "bin/plugin-linux"
  },
  "protocol": "jsonrpc-stdio",
  "permissions": ["ai:chat", "ai:voice"],
  "permissionReasons": {
    "ai:chat":  "è°ƒç”¨å¯¹è¯ AI ç”Ÿæˆä¼šè®®æ‘˜è¦å’Œå¾…åŠäº‹é¡¹",
    "ai:voice": "è®¢é˜…å®æ—¶è½¬å½•ç‰‡æ®µè¿›è¡Œåˆ†æ"
  },
  "sandboxLevel": "local",
  "homepage": "https://github.com/moraya-apps/moraya-meeting-assistant"
}
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| `id` | string | âœ“ | å…¨å±€å”¯ä¸€ï¼Œ`^[a-z][a-z0-9-]{2,63}$` |
| `name` | string | âœ“ | æ˜¾ç¤ºåç§° |
| `version` | string | âœ“ | semver æ ¼å¼ `x.y.z` |
| `description` | string | âœ“ | ä¸€å¥è¯æè¿° |
| `author` | string | âœ“ | ä½œè€…å |
| `license` | string | âœ“ | SPDX æ ‡è¯†ç¬¦ |
| `apiVersion` | string | âœ“ | å¿…é¡»ä¸º `"1"` |
| `entry` | object | âœ“ | å¹³å° â†’ å¯æ‰§è¡Œæ–‡ä»¶ç›¸å¯¹è·¯å¾„ï¼ˆä¸å« `../`ï¼‰|
| `protocol` | string | âœ“ | å¿…é¡»ä¸º `"jsonrpc-stdio"` |
| `permissions` | string[] | âœ“ | æƒé™åˆ—è¡¨ï¼ˆç©ºæ•°ç»„è¡¨ç¤ºæ— ç‰¹æ®Šæƒé™ï¼‰|
| `permissionReasons` | object | æ¨è | æ¯é¡¹æƒé™çš„è¯´æ˜ï¼Œæ˜¾ç¤ºåœ¨æˆæƒå¼¹æ¡† |
| `sandboxLevel` | string | âœ“ | `"sandbox"` / `"local"` / `"system"` |
| `homepage` | string | æ¨è | GitHub ä»“åº“åœ°å€ |

### æ²™ç®±ç­‰çº§ï¼ˆsandboxLevelï¼‰

| ç­‰çº§ | å«ä¹‰ | æ ‡è®° | å¸‚åœºå±•ç¤º |
|------|------|------|---------|
| `sandbox` | JS è„šæœ¬è¿è¡Œåœ¨ Moraya WebView æ²™ç®±ï¼Œæ—  OS èƒ½åŠ›ï¼ˆæœªæ¥æ”¯æŒï¼‰| ğŸŸ¢ | æ¨è |
| `local` | åŸç”ŸäºŒè¿›åˆ¶ï¼Œstdio é€šä¿¡ï¼Œæ— å¤–éƒ¨ç½‘ç»œå£°æ˜ | ğŸŸ¡ | æ­£å¸¸ |
| `system` | åŸç”ŸäºŒè¿›åˆ¶ + `net:external` æƒé™ï¼Œå¯è®¿é—®å¤–éƒ¨ç½‘ç»œ | ğŸ”´ | é¢å¤–è­¦å‘Š |

### æƒé™ç™½åå•

ä»¥ä¸‹æ˜¯ v1 æ”¯æŒçš„å…¨éƒ¨æƒé™ï¼Œå£°æ˜ä»»ä½•ä¸åœ¨æ­¤åˆ—è¡¨ä¸­çš„æƒé™ä¼šå¯¼è‡´å®‰è£…è¢«æ‹’ç»ï¼š

```
editor:read        è¯»å–å½“å‰æ–‡æ¡£å†…å®¹
editor:write       ä¿®æ”¹æ–‡æ¡£å†…å®¹ï¼ˆinsertText / replaceSelectionï¼‰
ai:chat            è°ƒç”¨å¯¹è¯ AIï¼ˆä½¿ç”¨ç”¨æˆ·å·²é…ç½®çš„ providerï¼‰
ai:image           è°ƒç”¨å›¾ç‰‡ç”Ÿæˆ AI
ai:voice           è®¢é˜…è¯­éŸ³è½¬å½•äº‹ä»¶ï¼Œè¯»å–å£°çº¹æ¡£æ¡ˆ
ai:voice:capture   æ§åˆ¶å½•éŸ³ä¼šè¯å¼€å¯/åœæ­¢ï¼ˆéœ€é¦–æ¬¡ç”¨æˆ·æˆæƒï¼‰
net:external       æ’ä»¶äºŒè¿›åˆ¶å¯è®¿é—®å¤–éƒ¨ç½‘ç»œï¼ˆsystem çº§ä¸“å±ï¼‰
```

---

## F2ï¼šRust æ’ä»¶è¿›ç¨‹ç®¡ç†å™¨ï¼ˆplugin_manager.rsï¼‰

ä» `mcp.rs` çš„ `MCPProcessManager` æå–å¹¶æ‰©å±•ï¼Œå®ç° `PluginProcessManager`ã€‚

### æ’ä»¶å­˜å‚¨ç»“æ„

```
{appDataDir}/
  plugins/
    {pluginId}/
      plugin.json        â† å®‰è£…æ—¶ä» zip è§£å‹
      bin/               â† å¹³å°å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆchmod +x åï¼‰
      data/              â† æ’ä»¶è‡ªæœ‰æ•°æ®ç›®å½•
  plugin-state.json      â† Tauri Storeï¼šå·²å®‰è£…åˆ—è¡¨ + enabled çŠ¶æ€
  plugin-registry-cache.json  â† å¸‚åœºæ•°æ®ç¼“å­˜ï¼ˆ30åˆ†é’Ÿè¿‡æœŸï¼‰
```

### Tauri å‘½ä»¤åˆ—è¡¨

```rust
// å®‰è£…
#[tauri::command]
async fn plugin_install_local(zip_path: String, ...) -> Result<InstalledPlugin, String>

#[tauri::command]
async fn plugin_install_from_url(download_url: String, expected_sha256: String, ...) -> Result<InstalledPlugin, String>

// ç”Ÿå‘½å‘¨æœŸ
#[tauri::command]
async fn plugin_enable(id: String, ...) -> Result<(), String>

#[tauri::command]
async fn plugin_disable(id: String, ...) -> Result<(), String>

#[tauri::command]
async fn plugin_uninstall(id: String, ...) -> Result<(), String>

// æŸ¥è¯¢
#[tauri::command]
async fn plugin_list(...) -> Result<Vec<InstalledPluginStatus>, String>

// å¸‚åœº
#[tauri::command]
async fn plugin_registry_fetch(force_refresh: bool, ...) -> Result<RegistryData, String>

#[tauri::command]
async fn plugin_validate_manifest(url_or_path: String, ...) -> Result<ValidationResult, String>

// é€šä¿¡
#[tauri::command]
async fn plugin_invoke(id: String, method: String, params: Value, ...) -> Result<Value, String>
```

### å®‰å…¨å®ç°è¦ç‚¹

**SHA256 éªŒè¯ï¼ˆå®‰è£…æ—¶å¼ºåˆ¶æ‰§è¡Œï¼‰**ï¼š
```rust
// ä¸‹è½½ zip åï¼Œè®¡ç®—å®é™…å“ˆå¸Œå€¼
let actual_hash = sha256_of_file(&zip_path)?;
if actual_hash != expected_sha256 {
    return Err("æ–‡ä»¶å®Œæ•´æ€§éªŒè¯å¤±è´¥ï¼Œå·²é˜»æ­¢å®‰è£…".to_string());
}
```

**Zip Slip é˜²æŠ¤ï¼ˆè§£å‹æ—¶ï¼‰**ï¼š
```rust
// æ‹’ç»æ‰€æœ‰å« ../ æˆ–ç»å¯¹è·¯å¾„çš„ zip æ¡ç›®
for entry in zip.files() {
    let path = entry.name();
    if path.contains("..") || path.starts_with('/') || path.starts_with('\\') {
        return Err("zip æ–‡ä»¶åŒ…å«éæ³•è·¯å¾„ï¼Œæ‹’ç»å®‰è£…".to_string());
    }
}
```

**è¿›ç¨‹å¯åŠ¨**ï¼ˆå¤ç”¨ MCP çš„ env è¿‡æ»¤é€»è¾‘ï¼‰ï¼š
```rust
// è¿‡æ»¤å±é™©ç¯å¢ƒå˜é‡ï¼Œä¸ mcp.rs ä¿æŒä¸€è‡´
let safe_env: HashMap<String, String> = std::env::vars()
    .filter(|(k, _)| !is_dangerous_env_var(k))
    .collect();
```

**åƒµå°¸è¿›ç¨‹é˜²æŠ¤**ï¼ˆå¤ç”¨ MCP çš„ wait() æ¨¡å¼ï¼‰ï¼š
```rust
// kill åå¿…é¡» wait()ï¼Œé˜²æ­¢åƒµå°¸è¿›ç¨‹
child.kill()?;
child.wait()?;
```

**é»‘åå•æ£€æŸ¥**ï¼š
```rust
// å¯åŠ¨æ—¶æ‹‰å– blacklist.jsonï¼Œå‘½ä¸­åˆ™å¼ºåˆ¶åœç”¨
async fn check_blacklist(id: &str) -> bool { ... }
```

---

## F3ï¼šMoraya Plugin API v1

æ’ä»¶é€šè¿‡ **JSON-RPC 2.0 over stdio** ä¸ Moraya é€šä¿¡ã€‚Moraya å……å½“æ‰€æœ‰èƒ½åŠ›çš„ä»£ç†ï¼Œæ’ä»¶ä¸æŒæœ‰ä»»ä½• API Keyã€‚

### åŸºç¡€æ–¹æ³•ï¼ˆæ— éœ€æƒé™ï¼‰

```jsonc
// å¿ƒè·³æ£€æµ‹
{ "method": "moraya.ping" } â†’ "pong"

// ç‰ˆæœ¬ä¿¡æ¯
{ "method": "moraya.getVersion" } â†’ "0.16.0"

// å½“å‰ UI è¯­è¨€
{ "method": "moraya.getLocale" } â†’ "zh-CN" | "en"
```

### ç¼–è¾‘å™¨ï¼ˆæ— éœ€æƒé™ï¼‰

```jsonc
// è¯»å–æ–‡æ¡£ï¼ˆéœ€å£°æ˜ editor:read æ‰èƒ½è¯»å–å†…å®¹ï¼‰
{ "method": "moraya.editor.getContent" }
â†’ { "markdown": "# æ ‡é¢˜\n...", "filePath": "/path/to/file.md" }

// åœ¨å…‰æ ‡å¤„æ’å…¥æ–‡æœ¬ï¼ˆéœ€å£°æ˜ editor:writeï¼‰
{ "method": "moraya.editor.insertText", "params": { "text": "æ’å…¥å†…å®¹" } }
â†’ { "ok": true }

// è·å–é€‰ä¸­æ–‡æœ¬
{ "method": "moraya.editor.getSelection" }
â†’ { "text": "é€‰ä¸­çš„æ–‡å­—", "isEmpty": false }

// æ›¿æ¢é€‰ä¸­æ–‡æœ¬ï¼ˆéœ€å£°æ˜ editor:writeï¼‰
{ "method": "moraya.editor.replaceSelection", "params": { "text": "æ–°å†…å®¹" } }
â†’ { "ok": true }
```

äº‹ä»¶ï¼ˆMoraya â†’ æ’ä»¶ï¼‰ï¼š
```jsonc
// æ–‡æ¡£å†…å®¹å˜åŒ–ï¼ˆéœ€å£°æ˜ editor:readï¼‰
{ "method": "editor.onChange",
  "params": { "markdown": "...", "filePath": "..." } }
```

### UIï¼ˆæ— éœ€æƒé™ï¼‰

```jsonc
// Toast é€šçŸ¥
{ "method": "moraya.ui.showNotification",
  "params": { "message": "å¤„ç†å®Œæˆ", "type": "success" } }

// åŸç”Ÿç¡®è®¤å¯¹è¯æ¡†
{ "method": "moraya.ui.showDialog",
  "params": { "title": "ç¡®è®¤æ“ä½œ", "message": "æ˜¯å¦ç»§ç»­ï¼Ÿ" } }
â†’ { "confirmed": true }

// çŠ¶æ€æ ä¸´æ—¶æ–‡å­—ï¼ˆè‡ªåŠ¨æ¶ˆå¤±ï¼‰
{ "method": "moraya.ui.setStatusText",
  "params": { "text": "æ­£åœ¨åˆ†æ...", "durationMs": 3000 } }
```

### AI å¯¹è¯ï¼ˆéœ€å£°æ˜ `ai:chat`ï¼‰

```jsonc
// ä¸€æ¬¡æ€§å¯¹è¯ï¼ˆåŒæ­¥è¿”å›ï¼‰
{
  "method": "moraya.ai.chat.complete",
  "params": {
    "messages": [
      { "role": "system", "content": "ä½ æ˜¯ä¸€ä¸ªå†™ä½œåŠ©æ‰‹" },
      { "role": "user", "content": "è¯·æ€»ç»“ä»¥ä¸‹å†…å®¹ï¼š..." }
    ],
    "maxTokens": 1000,      // å¯é€‰ï¼Œè¦†ç›–ç”¨æˆ·é…ç½®
    "temperature": 0.7      // å¯é€‰
  }
}
â†’ {
    "content": "æ‘˜è¦å†…å®¹...",
    "model": "claude-sonnet-4-6",
    "usage": { "inputTokens": 120, "outputTokens": 340 },
    "stopReason": "end_turn"
  }

// æµå¼å¯¹è¯ï¼ˆchunks é€šè¿‡ Notification æ¨é€ï¼‰
{
  "method": "moraya.ai.chat.stream",
  "params": {
    "requestId": "req-abc123",
    "messages": [ ... ]
  }
}
â†’ { "requestId": "req-abc123", "started": true }  // ç«‹å³è¿”å› ack

// åç»­æ¨é€ï¼ˆMoraya â†’ æ’ä»¶ï¼‰ï¼š
{ "method": "ai.chat.onChunk",
  "params": { "requestId": "req-abc123", "delta": "æ­£åœ¨", "done": false } }
{ "method": "ai.chat.onChunk",
  "params": { "requestId": "req-abc123", "delta": "ç”Ÿæˆ...", "done": false } }
{ "method": "ai.chat.onChunk",
  "params": { "requestId": "req-abc123", "delta": "", "done": true,
              "usage": { "inputTokens": 85, "outputTokens": 210 } } }

// å–æ¶ˆæµå¼è¯·æ±‚
{ "method": "moraya.ai.chat.abort", "params": { "requestId": "req-abc123" } }

// è·å–å½“å‰å¯¹è¯é…ç½®ï¼ˆä¸å« Keyï¼‰
{ "method": "moraya.ai.chat.getConfig" }
â†’ { "provider": "claude", "model": "claude-sonnet-4-6", "hasConfig": true }
```

### AI ç”Ÿå›¾ï¼ˆéœ€å£°æ˜ `ai:image`ï¼‰

```jsonc
{
  "method": "moraya.ai.image.generate",
  "params": {
    "prompt": "a serene mountain lake at sunrise",
    "negativePrompt": "blur, watermark",  // å¯é€‰
    "ratio": "16:9",                      // å¯é€‰ï¼Œè¦†ç›–ç”¨æˆ·é»˜è®¤é…ç½®
    "sizeLevel": "medium"                 // å¯é€‰
  }
}
â†’ {
    "url": "https://...",        // äº‘ç«¯ URLï¼ˆéƒ¨åˆ† provider è¿”å›ï¼‰
    "base64": "...",             // base64 æ•°æ®ï¼ˆéƒ¨åˆ† provider è¿”å›ï¼ŒäºŒé€‰ä¸€ï¼‰
    "mimeType": "image/png",
    "width": 1280,
    "height": 720,
    "provider": "openai",
    "model": "dall-e-3"
  }

// è·å–å½“å‰å›¾ç‰‡ç”Ÿæˆé…ç½®ï¼ˆä¸å« Keyï¼‰
{ "method": "moraya.ai.image.getConfig" }
â†’ { "provider": "openai", "model": "dall-e-3",
    "defaultRatio": "16:9", "defaultSizeLevel": "medium", "hasConfig": true }
```

### AI è¯­éŸ³ï¼ˆéœ€å£°æ˜ `ai:voice`ï¼‰

```jsonc
// è®¢é˜…å®æ—¶è½¬å½•æµ
{ "method": "moraya.ai.voice.subscribeSegments" }
â†’ { "subscribed": true, "sessionActive": false }

// å®æ—¶æ¨é€ï¼ˆMoraya â†’ æ’ä»¶ï¼‰ï¼š
{ "method": "ai.voice.onSegment",
  "params": {
    "sessionId": "sess-xyz",
    "speakerId": "SPEAKER_0",
    "profileId": "profile-abc",
    "displayName": "å¼ æ€»",
    "text": "æˆ‘ä»¬æ¥èŠä¸€èŠè¿™ä¸ªé¡¹ç›®",
    "startMs": 1200, "endMs": 3400,
    "isFinal": true, "speechFinal": true
  }
}

// ä¼šè¯ç”Ÿå‘½å‘¨æœŸäº‹ä»¶
{ "method": "ai.voice.onSessionStart",
  "params": { "sessionId": "sess-xyz", "provider": "deepgram", "model": "nova-3" } }

{ "method": "ai.voice.onSessionEnd",
  "params": {
    "sessionId": "sess-xyz",
    "durationMs": 180000,
    "segmentCount": 42,
    "speakers": [
      { "speakerId": "SPEAKER_0", "displayName": "å¼ æ€»", "totalSpeakingMs": 92000 }
    ]
  }
}

// è·å–å·²ä¿å­˜å£°çº¹æ¡£æ¡ˆ
{ "method": "moraya.ai.voice.getProfiles" }
â†’ {
    "profiles": [
      { "id": "profile-abc", "nickname": "å¼ æ€»", "autoName": "ç”·1å·",
        "gender": "male", "color": "#4A90D9", "sampleDurationMs": 15000 }
    ]
  }

// è·å–è½¬å½•æ–‡æœ¬ï¼ˆçœç•¥ sessionId åˆ™è¿”å›æœ€è¿‘ä¸€æ¬¡ï¼‰
{ "method": "moraya.ai.voice.getTranscript",
  "params": { "sessionId": "sess-xyz" } }
â†’ { "segments": [...], "plainText": "å…¨æ–‡å†…å®¹", "markdownText": "**å¼ æ€»**: ..." }

// å¯¹è½¬å½•å†…å®¹ AI æ€»ç»“ï¼ˆæµå¼ï¼Œå¤ç”¨ ai.chat.onChunk äº‹ä»¶ï¼‰
{ "method": "moraya.ai.voice.summarize",
  "params": {
    "requestId": "req-sum-001",
    "sessionId": "sess-xyz",
    "prompt": "æå–ä¼šè®®ä¸­çš„å¾…åŠäº‹é¡¹"  // å¯é€‰ï¼Œè¦†ç›–é»˜è®¤æ€»ç»“ prompt
  }
}
```

**æ§åˆ¶å½•éŸ³ä¼šè¯ï¼ˆéœ€é¢å¤–å£°æ˜ `ai:voice:capture`ï¼‰**ï¼š

```jsonc
// å¼€å§‹å½•éŸ³ï¼ˆMoraya æ˜¾ç¤ºã€Œæ’ä»¶ X æ­£åœ¨è¯·æ±‚å½•éŸ³ã€æˆæƒå¼¹æ¡†ï¼‰
{ "method": "moraya.ai.voice.startSession",
  "params": { "language": "zh", "reason": "ä¼šè®®å®æ—¶åˆ†æ" } }
â†’ { "sessionId": "sess-xyz", "started": true }

// åœæ­¢å½•éŸ³
{ "method": "moraya.ai.voice.stopSession" }
â†’ { "ok": true }
```

### AI Token ä½¿ç”¨é™åˆ¶

Moraya å¼ºåˆ¶æ‰§è¡Œ plugin.json ä¸­å£°æ˜çš„é™é¢ï¼Œé˜²æ­¢ Token æ»¥ç”¨ï¼š

```json
{
  "permissions": ["ai:chat"],
  "limits": {
    "ai:chat:callsPerMinute": 5,
    "ai:chat:tokensPerDay": 50000
  }
}
```

è¶…å‡ºé™åˆ¶æ—¶ï¼Œ`moraya.ai.chat.complete` è¿”å›é”™è¯¯ `{ "error": "rate_limit_exceeded" }`ï¼Œå¹¶æ¨é€ Toast é€šçŸ¥ç”¨æˆ·ã€‚

---

## F4ï¼šæ’ä»¶ç®¡ç† UIï¼ˆè®¾ç½®é¢æ¿æ–° Tabï¼‰

åœ¨ `SettingsPanel.svelte` æ–°å¢ç¬¬ 10 ä¸ª Tabã€Œæ’ä»¶ã€ï¼Œå†…å«ä¸¤ä¸ªè§†å›¾ã€‚

### è§†å›¾ Aï¼šå·²å®‰è£…åˆ—è¡¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [å·²å®‰è£… (2)]  [æµè§ˆå¸‚åœº]                               â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸŸ¡ moraya-meeting-assistant       v0.2.1          â”‚  â”‚
â”‚  â”‚    ä¼šè®®åŠ©æ‰‹ Â· Moraya Team                         â”‚  â”‚
â”‚  â”‚    ai:chat  ai:voice                              â”‚  â”‚
â”‚  â”‚    AI ä½¿ç”¨ï¼šæœ¬æœˆ 12,340 tokens          [â— å¯ç”¨]  â”‚  â”‚
â”‚  â”‚                                          [å¸è½½]   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ ğŸŸ¡ moraya-wordcount               v0.3.0          â”‚  â”‚
â”‚  â”‚    å­—æ•°ç»Ÿè®¡å¢å¼º Â· Jane Doe                        â”‚  â”‚
â”‚  â”‚    æ— ç‰¹æ®Šæƒé™                                     â”‚  â”‚
â”‚  â”‚                                         [â—‹ åœç”¨]  â”‚  â”‚
â”‚  â”‚                                          [å¸è½½]   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚                       [ä»æœ¬åœ°æ–‡ä»¶å®‰è£… .zip â†‘]           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**AI ä½¿ç”¨è®°å½•**ï¼ˆç‚¹å‡»å±•å¼€ï¼‰ï¼š
```
ä»Šå¤© 14:32  ai:chat  â†’ 342 tokens
ä»Šå¤© 14:31  ai:chat  â†’ 128 tokens
æ˜¨å¤© 09:15  ai:chat  â†’ 891 tokens
æœ¬æœˆç´¯è®¡ï¼š12,340 tokens
```

### è§†å›¾ Bï¼šæµè§ˆå¸‚åœº

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [å·²å®‰è£… (2)]  [æµè§ˆå¸‚åœº]                               â”‚
â”‚                                                         â”‚
â”‚  [ğŸ” æœç´¢æ’ä»¶...              ]    â†» æ›´æ–°åˆ—è¡¨           â”‚
â”‚                                                         â”‚
â”‚  åˆ†ç±»: [å…¨éƒ¨â–¼] [ç¼–è¾‘å™¨] [AIåŠ©æ‰‹] [è¯­éŸ³] [å·¥å…·] [æ¨¡æ¿]   â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ âœ¦ å®˜æ–¹è®¤è¯                                        â”‚  â”‚
â”‚  â”‚ moraya-hello                          v0.1.0      â”‚  â”‚
â”‚  â”‚ Hello World Â· å…¥é—¨æ¨¡æ¿                            â”‚  â”‚
â”‚  â”‚ æ’ä»¶å¼€å‘è„šæ‰‹æ¶ï¼Œå«å®Œæ•´ä¸‰å¹³å° CI æ„å»ºæµç¨‹           â”‚  â”‚
â”‚  â”‚ Moraya Team Â· MIT Â· â˜… 156 Â· 2.1k å®‰è£…            â”‚  â”‚
â”‚  â”‚ API v1  ğŸŸ¢ æ²™ç®±  æ— ç‰¹æ®Šæƒé™           [å®‰è£…]      â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ moraya-meeting-assistant              v0.2.1      â”‚  â”‚
â”‚  â”‚ ä¼šè®®åŠ©æ‰‹                                          â”‚  â”‚
â”‚  â”‚ å®æ—¶è½¬å½• + AI æ‘˜è¦ + å¾…åŠæå–                     â”‚  â”‚
â”‚  â”‚ Moraya Team Â· Apache-2.0 Â· â˜… 89 Â· 870 å®‰è£…       â”‚  â”‚
â”‚  â”‚ API v1  ğŸŸ¡ æœ¬åœ°  ai:chat  ai:voice  [å·²å®‰è£… âœ“]   â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ moraya-exporter                       v0.5.0      â”‚  â”‚
â”‚  â”‚ æ–‡æ¡£å¯¼å‡ºå¢å¼º                                      â”‚  â”‚
â”‚  â”‚ PDFã€DOCXã€EPUB å¯¼å‡ºæ”¯æŒ                          â”‚  â”‚
â”‚  â”‚ Jane Doe Â· MIT Â· â˜… 43 Â· 321 å®‰è£…                 â”‚  â”‚
â”‚  â”‚ API v1  ğŸ”´ ç³»ç»Ÿ  net:external  éœ€å¤–éƒ¨ç½‘ç»œè®¿é—®     â”‚  â”‚
â”‚  â”‚                                        [å®‰è£…]     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ’ä»¶è¯¦æƒ…ä¾§æ»‘é¢æ¿

ç‚¹å‡»æ’ä»¶å¡ç‰‡æ—¶ä»å³ä¾§æ»‘å…¥ï¼Œå®½åº¦ 320pxï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† moraya-meeting-assistant       â”‚
â”‚                        v0.2.1    â”‚
â”‚ ä¼šè®®åŠ©æ‰‹ Â· Moraya Team           â”‚
â”‚ Apache-2.0 Â· â˜… 89 Â· 870 å®‰è£…    â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚ å®æ—¶æ¥æ”¶ Moraya è½¬å½•æµï¼Œè°ƒç”¨ AI  â”‚
â”‚ ç”Ÿæˆä¼šè®®æ‘˜è¦ã€æå–å¾…åŠäº‹é¡¹ï¼Œç»“æœ â”‚
â”‚ ä¸€é”®æ’å…¥å½“å‰æ–‡æ¡£ã€‚               â”‚
â”‚                                  â”‚
â”‚ æ²™ç®±ç­‰çº§                         â”‚
â”‚ ğŸŸ¡ æœ¬åœ°æ’ä»¶ï¼ˆåŸç”ŸäºŒè¿›åˆ¶ï¼‰        â”‚
â”‚                                  â”‚
â”‚ æ‰€éœ€æƒé™                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ai:chat  è°ƒç”¨å¯¹è¯ AI åšæ‘˜è¦  â”‚ â”‚
â”‚ â”‚ ai:voice è®¢é˜…å®æ—¶è½¬å½•ç‰‡æ®µ    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â”‚
â”‚ æ›´æ–°æ—¥å¿—                         â”‚
â”‚ v0.2.1  ä¿®å¤ä¸­æ–‡æ–­å¥è¯†åˆ«         â”‚
â”‚ v0.2.0  æ”¯æŒ ai:voice æµå¼è®¢é˜…   â”‚
â”‚                                  â”‚
â”‚ [æŸ¥çœ‹æºç  â†—]        [å®‰è£…]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## F5ï¼šæ’ä»¶æ³¨å†Œè¡¨ï¼ˆGitHub å»ä¸­å¿ƒåŒ–è®¾è®¡ï¼‰

### æ³¨å†Œè¡¨ä»“åº“ç»“æ„

æ–°å»ºç‹¬ç«‹ä»“åº“ï¼š`github.com/moraya-apps/moraya-plugin-registry`

```
moraya-plugin-registry/
â”œâ”€â”€ index.json          â† ä¸»ç´¢å¼•ï¼ˆMoraya è¯»å–æ­¤æ–‡ä»¶ï¼‰
â”œâ”€â”€ blacklist.json      â† æ¶æ„æ’ä»¶é»‘åå•
â”œâ”€â”€ CONTRIBUTING.md     â† æ’ä»¶æäº¤ PR æŒ‡å—
â””â”€â”€ plugins/
    â”œâ”€â”€ moraya-hello/
    â”‚   â””â”€â”€ icon.png    â† æ’ä»¶å›¾æ ‡ï¼ˆ64Ã—64 PNGï¼‰
    â””â”€â”€ moraya-meeting-assistant/
        â””â”€â”€ icon.png
```

### index.jsonï¼šåªå­˜ä»“åº“åœ°å€ + é”å®šç‰ˆæœ¬

æ³¨å†Œè¡¨**ä¸å­˜å‚¨ä»»ä½•åŠ¨æ€æ•°æ®**ï¼ˆæè¿°ã€star æ•°ç­‰å‡å®æ—¶ä» GitHub æ‹‰å–ï¼‰ï¼Œåªå­˜å‚¨ç»ç»´æŠ¤è€…å®¡æ ¸çš„ä¿¡æ¯ï¼š

```json
{
  "version": 1,
  "updatedAt": "2026-02-26T00:00:00Z",
  "plugins": [
    {
      "id": "moraya-hello",
      "repo": "moraya-apps/moraya-hello",
      "category": "template",
      "verified": true,
      "pinnedVersion": "0.1.0",
      "sha256": {
        "darwin-aarch64": "a3f8c2d1e4b57f90c2d3e4f5a6b7c8d9...",
        "darwin-x86_64":  "9b2e7f0a1c4d5e6f7a8b9c0d1e2f3a4b...",
        "win32":          "5d1a8c3f2e9b0c1d2e3f4a5b6c7d8e9f...",
        "linux-x86_64":   "7e4b1f2a0c5d6e7f8a9b0c1d2e3f4a5b..."
      }
    },
    {
      "id": "moraya-meeting-assistant",
      "repo": "moraya-apps/moraya-meeting-assistant",
      "category": "ai",
      "verified": true,
      "pinnedVersion": "0.2.1",
      "sha256": {
        "darwin-aarch64": "...",
        "darwin-x86_64":  "...",
        "win32":          "...",
        "linux-x86_64":   "..."
      }
    }
  ]
}
```

### blacklist.json

```json
{
  "blacklist": [
    {
      "id": "moraya-badplugin",
      "repo": "evil-user/moraya-badplugin",
      "reason": "å‘ç°æœªå£°æ˜çš„å¤–éƒ¨æ•°æ®ä¸ŠæŠ¥è¡Œä¸º",
      "reportedAt": "2026-03-01",
      "affectedVersions": ["0.1.0", "0.1.1"]
    }
  ]
}
```

Moraya å¯åŠ¨æ—¶æ‹‰å–é»‘åå•ï¼›å‘½ä¸­å·²å®‰è£…æ’ä»¶ â†’ å¼ºåˆ¶åœç”¨ + é¡¶éƒ¨çº¢è‰²è­¦å‘Šæ¨ªå¹…ã€‚

### æ’ä»¶æäº¤æµç¨‹ï¼ˆç¤¾åŒº PRï¼‰

```
å¼€å‘è€…åœ¨è‡ªå·±çš„ GitHub repo ç”¨ GitHub Actions CI æ„å»ºå¹¶å‘å¸ƒ Release
ï¼ˆè¦æ±‚ï¼šå¿…é¡»ä½¿ç”¨ CI æ„å»ºï¼Œç¦æ­¢ä¸Šä¼ æœ¬åœ°é¢„æ„å»ºäºŒè¿›åˆ¶ï¼‰
    â†“
å‘ moraya-plugin-registry æäº¤ PR
  ä¿®æ”¹ index.jsonï¼Œæ–°å¢ä¸€è¡Œï¼š
    { "id": "...", "repo": "author/repo",
      "pinnedVersion": "x.y.z", "sha256": { ... } }
  å·¥å…·è‡ªåŠ¨è®¡ç®—å„å¹³å° zip çš„ SHA256ï¼ˆé™„ CI è„šæœ¬ï¼‰
    â†“
PR è§¦å‘è‡ªåŠ¨åŒ– AI å®¡æ ¸ï¼ˆplugin-review.ymlï¼‰
    â†“ è‡ªåŠ¨å®Œæˆï¼š
  1. ä¸‹è½½å„å¹³å° zipï¼ŒéªŒè¯ SHA256 ä¸ PR ä¸­ä¸€è‡´
  2. è§£å‹ zipï¼Œæ ¡éªŒ plugin.json æ ¼å¼ä¸æƒé™åˆæ³•æ€§
  3. æ‹‰å– repo å…¨éƒ¨æºç ï¼Œå‘é€ Claude API å®‰å…¨åˆ†æï¼š
     - æ˜¯å¦æœ‰æœªå£°æ˜çš„ç½‘ç»œè¯·æ±‚ï¼ˆHTTP client è°ƒç”¨ï¼‰
     - æ˜¯å¦è®¿é—®äº† data/ ç›®å½•ä»¥å¤–çš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„
     - æ˜¯å¦æ‰§è¡Œäº†å­è¿›ç¨‹
     - ä»£ç è¡Œä¸ºæ˜¯å¦ä¸å£°æ˜æƒé™ä¸€è‡´
  4. å°†åˆ†ææŠ¥å‘Šä»¥è¯„è®ºå½¢å¼ post åˆ° PR
    â†“
ç»´æŠ¤è€…å‚è€ƒ AI æŠ¥å‘Šåšæœ€ç»ˆå†³ç­–ï¼š
  - ä½é£é™©ï¼ˆAI å…¨ç»¿ï¼‰â†’ å¿«é€Ÿåˆå¹¶
  - æœ‰è­¦å‘Šï¼ˆAI æ ‡é»„ï¼‰â†’ äººå·¥é‡ç‚¹æ ¸æŸ¥å¯¹åº”ä»£ç 
  - é«˜é£é™©ï¼ˆAI æ ‡çº¢ï¼‰â†’ è¦æ±‚ä½œè€…è§£é‡Šæˆ–æ‹’ç»
    â†“
PR åˆå¹¶ â†’ æ‰€æœ‰ Moraya ç”¨æˆ·åˆ·æ–°å¸‚åœºåå¯è§

ç‰ˆæœ¬æ›´æ–°ï¼ˆåŒä¸Šæµç¨‹ï¼Œå¿…é¡»æ PR æ›´æ–° pinnedVersion + sha256ï¼Œå†æ¬¡è§¦å‘ AI å®¡æ ¸ï¼‰
```

**è¦æ±‚æ’ä»¶ä½¿ç”¨ CI æ„å»ºçš„åŸå› **ï¼šGitHub Actions æ„å»ºæ—¥å¿—å…¬å¼€å¯æŸ¥ï¼Œç»´æŠ¤è€…å¯è¿½æº¯"è¿™ä¸ªäºŒè¿›åˆ¶æ˜¯ç”±å“ªä»½æºç åœ¨ä»€ä¹ˆç¯å¢ƒä¸‹æ„å»ºçš„"ï¼Œå¤§å¹…é™ä½"æºç å¹²å‡€ä½†äºŒè¿›åˆ¶è—åé—¨"çš„é£é™©ã€‚

**AI å®¡æ ¸çš„å±€é™æ€§**ï¼šAI åªèƒ½åˆ†ææºç å¿«ç…§ï¼Œæ— æ³•ä¿è¯ 100% è¦†ç›–æ··æ·†ä»£ç ï¼›å› æ­¤ AI å®¡æ ¸å®šä½ä¸º"è¾…åŠ©å·¥å…·ï¼Œé™ä½äººå·¥æˆæœ¬"ï¼Œç»´æŠ¤è€…ä»ä¿ç•™æœ€ç»ˆå†³ç­–æƒã€‚é—­æºæ’ä»¶ï¼ˆæ— å…¬å¼€æºç ï¼‰ä¸å¾—æäº¤æ³¨å†Œè¡¨ã€‚

**å…³é”®å®‰å…¨ä¿éšœ**ï¼šæ’ä»¶ä½œè€…æ›´æ–°è‡ªå·±çš„ GitHub Releaseï¼ˆæ— è®ºæ˜¯å¦æ¶æ„ï¼‰ï¼Œåœ¨æ³¨å†Œè¡¨ PR åˆå¹¶ä¹‹å‰ï¼Œç”¨æˆ·å®‰è£…/æ›´æ–°çš„å§‹ç»ˆæ˜¯ç»´æŠ¤è€…å®¡æ ¸è¿‡çš„ç‰ˆæœ¬ï¼ŒSHA256 ä¸åŒ¹é…åˆ™å®‰è£…ä¸­æ­¢ã€‚

---

## F6ï¼šåŠ¨æ€æ•°æ®æ‹‰å–ï¼ˆå¸‚åœºå®æ—¶æ•°æ®ï¼‰

æ³¨å†Œè¡¨ä¸­åªæœ‰ `repo` å­—æ®µï¼Œå…¶ä½™æ•°æ®å®æ—¶ä» GitHub API è·å–ã€‚

### å¹¶å‘æ‹‰å–æµç¨‹

```
æ‰“å¼€å¸‚åœº Tab
    â†“
ç«‹å³å±•ç¤ºæœ¬åœ°ç¼“å­˜ï¼ˆ{appDataDir}/plugin-registry-cache.jsonï¼‰
    â†“
åå°å¹¶å‘ï¼šå¯¹æ¯ä¸ª repo åŒæ—¶è¯·æ±‚ä¸‰ä¸ª GitHub API

â‘  GET /repos/{owner}/{repo}
   â†’ name, description, stars, license, topics, updated_at

â‘¡ GET /repos/{owner}/{repo}/releases/latest
   â†’ version, changelog, release assetsï¼ˆå„å¹³å°ä¸‹è½½ URL + æ–‡ä»¶å¤§å°ï¼‰

â‘¢ GET raw.githubusercontent.com/{owner}/{repo}/main/plugin.json
   â†’ apiVersion, permissions, entry, sandboxLevel

åˆå¹¶ä¸‰ä¸ªç»“æœ â†’ æ›´æ–°ç¼“å­˜ â†’ åˆ·æ–° UI
```

### ç¼“å­˜ç­–ç•¥

| åœºæ™¯ | è¡Œä¸º |
|------|------|
| æ‰“å¼€å¸‚åœºï¼ˆç¼“å­˜ < 30 åˆ†é’Ÿï¼‰| ç«‹å³æ˜¾ç¤ºç¼“å­˜ï¼Œåå°é™é»˜åˆ·æ–° |
| æ‰“å¼€å¸‚åœºï¼ˆç¼“å­˜ â‰¥ 30 åˆ†é’Ÿï¼‰| æ˜¾ç¤ºç¼“å­˜ + loading åŠ¨ç”»ï¼Œåˆ·æ–°å®Œæˆåæ›´æ–° |
| ç‚¹å‡»ã€Œâ†» æ›´æ–°åˆ—è¡¨ã€| å¼ºåˆ¶åˆ·æ–°ï¼Œå¿½ç•¥ç¼“å­˜æ—¶é—´ |
| æ— ç½‘ç»œ | ä»…æ˜¾ç¤ºç¼“å­˜ï¼Œè§’æ ‡æç¤ºã€Œä½¿ç”¨ç¼“å­˜æ•°æ®ã€|
| GitHub API é™æµï¼ˆ60æ¬¡/å°æ—¶ï¼‰| è§¦å‘æ—¶å±•ç¤ºä¸Šæ¬¡ç¼“å­˜ï¼Œæç¤ºã€ŒGitHub API é™æµï¼Œç¨åé‡è¯•ã€|

---

## F7ï¼šä¸€é”®å®‰è£…è”åŠ¨æµç¨‹

### åœ¨çº¿å®‰è£…ï¼ˆå¸‚åœºï¼‰

```
ç”¨æˆ·ç‚¹å‡» [å®‰è£…]
    â†“
æŒ‰é’®å˜ä¸º [å®‰è£…ä¸­... â—Œ]
    â†“
â‘  åŒ¹é…å½“å‰å¹³å°ä¸‹è½½ URLï¼š
    darwin-aarch64 / darwin-x86_64 / win32 / linux-x86_64
    æ— åŒ¹é… â†’ æç¤ºã€Œæ­¤æ’ä»¶æš‚ä¸æ”¯æŒ {platform}ã€ï¼Œç»ˆæ­¢
    â†“
â‘¡ Rust ä¸‹è½½ zip â†’ å®æ—¶æ¨é€è¿›åº¦åˆ°å‰ç«¯
    è¿›åº¦æ¡æ˜¾ç¤ºï¼šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  73%  ä¸‹è½½ä¸­... (2.1 MB / 3.4 MB)
    â†“
â‘¢ è®¡ç®— SHA256 â†’ ä¸æ³¨å†Œè¡¨ sha256 å¯¹æ¯”
    ä¸åŒ¹é… â†’ æç¤ºã€Œæ–‡ä»¶å®Œæ•´æ€§éªŒè¯å¤±è´¥ï¼Œå·²é˜»æ­¢å®‰è£…ã€ï¼Œç»ˆæ­¢
    â†“
â‘£ è§£å‹åˆ°ä¸´æ—¶ç›®å½•ï¼Œè¯»å– plugin.jsonï¼Œæ‰§è¡Œåˆæ³•æ€§éªŒè¯ï¼ˆè§ F8ï¼‰
    éªŒè¯å¤±è´¥ â†’ æç¤ºå…·ä½“é”™è¯¯ï¼Œç»ˆæ­¢
    â†“
â‘¤ è‹¥æœ‰æ•æ„Ÿæƒé™ï¼ˆai:voice:capture / net:externalï¼‰
    â†’ å¼¹å‡ºåŸç”Ÿç³»ç»Ÿå¯¹è¯æ¡†ï¼Œæ˜¾ç¤ºæƒé™ + permissionReasons
    ç”¨æˆ·å–æ¶ˆ â†’ ç»ˆæ­¢
    â†“
â‘¥ ç§»åŠ¨åˆ° {appDataDir}/plugins/{id}/
    chmod +x äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆmacOS/Linuxï¼‰
    å†™å…¥ plugin-state.jsonï¼ˆenabled: falseï¼Œé»˜è®¤åœç”¨ï¼‰
    â†“
â‘¦ UI æ›´æ–°ï¼š
    å¸‚åœºå¡ç‰‡ â†’ [å·²å®‰è£… âœ“]
    å·²å®‰è£…åˆ—è¡¨ â†’ æ–°å¢è¯¥æ’ä»¶ï¼ˆåœç”¨çŠ¶æ€ï¼‰
    Toast â†’ ã€Œå®‰è£…å®Œæˆï¼Œå¯åœ¨å·²å®‰è£…åˆ—è¡¨ä¸­å¯ç”¨ã€
```

### æœ¬åœ°å®‰è£…ï¼ˆURL å¯¼å…¥ / zip æ–‡ä»¶ï¼‰

**è¾“å…¥æ–¹å¼**ï¼š
1. ç‚¹å‡»ã€Œä»æœ¬åœ°æ–‡ä»¶å®‰è£… .zipã€â†’ æ–‡ä»¶é€‰æ‹©æ¡†
2. è¾“å…¥ GitHub ä»“åº“ URLï¼ˆ`https://github.com/owner/repo`ï¼‰â†’ è‡ªåŠ¨æ‹‰å–æœ€æ–° Release å¹¶éªŒè¯

ä¸¤ç§æ–¹å¼è·³è¿‡ä¸‹è½½æ­¥éª¤ï¼ˆæœ¬åœ° zipï¼‰æˆ–ä¸‹è½½åï¼Œå‡è¿›å…¥ç›¸åŒçš„éªŒè¯â†’æˆæƒâ†’å®‰è£…æµç¨‹ã€‚

---

## F8ï¼šåˆæ³•æ€§éªŒè¯æœºåˆ¶

URL å¯¼å…¥å’Œæ‰€æœ‰å®‰è£…æµç¨‹å‡å¼ºåˆ¶æ‰§è¡Œä»¥ä¸‹éªŒè¯ï¼š

### éªŒè¯è§„åˆ™

| å±‚çº§ | å­—æ®µ | è§„åˆ™ | å¤±è´¥æç¤º |
|------|------|------|---------|
| **JSON æ ¼å¼** | æ–‡ä»¶æœ¬èº« | åˆæ³• JSON | `plugin.json æ ¼å¼é”™è¯¯ï¼Œæ— æ³•è§£æ` |
| **å¿…å¡«å­—æ®µ** | `id` | éç©ºï¼Œ`^[a-z][a-z0-9-]{2,63}$` | `id æ ¼å¼éæ³•ï¼ˆä»…å°å†™å­—æ¯ã€æ•°å­—ã€è¿å­—ç¬¦ï¼‰` |
| | `name` | éç©ºå­—ç¬¦ä¸² | `ç¼ºå°‘æ’ä»¶åç§° (name)` |
| | `version` | `^\d+\.\d+\.\d+$` | `ç‰ˆæœ¬å·æ ¼å¼é”™è¯¯ï¼Œéœ€ä¸º x.y.z` |
| | `apiVersion` | éç©ºå­—ç¬¦ä¸² | `ç¼ºå°‘ apiVersion` |
| | `protocol` | å¿…é¡»ä¸º `"jsonrpc-stdio"` | `ä¸æ”¯æŒçš„é€šä¿¡åè®®: {value}` |
| | `entry` | å¯¹è±¡ï¼Œè‡³å°‘å«ä¸€ä¸ªå¹³å°é”® | `ç¼ºå°‘ entry å­—æ®µ` |
| **å…¼å®¹æ€§** | `apiVersion` | å¿…é¡» â‰¤ Moraya å½“å‰æ”¯æŒï¼ˆ"1"ï¼‰| `éœ€è¦ API v{n}ï¼Œå½“å‰æ”¯æŒè‡³ v1ï¼Œè¯·å‡çº§ Moraya` |
| | `entry` | å«å½“å‰è¿è¡Œå¹³å°çš„é”® | `æ­¤æ’ä»¶æš‚ä¸æ”¯æŒ {platform}` |
| **å®‰å…¨** | `entry` è·¯å¾„ | ä¸å« `../`ã€ä¸ä»¥ `/` å¼€å¤´ | `entry è·¯å¾„å­˜åœ¨å®‰å…¨é£é™©ï¼Œæ‹’ç»å®‰è£…` |
| | `permissions` | æ¯é¡¹å¿…é¡»åœ¨æƒé™ç™½åå•å†… | `å£°æ˜äº†æœªçŸ¥æƒé™: {name}ï¼Œæ‹’ç»å®‰è£…` |
| | `id` | ä¸ä¸å·²å®‰è£…æ’ä»¶å†²çª | `æ’ä»¶ {id} å·²å®‰è£…ï¼Œå¦‚éœ€æ›´æ–°è¯·ä½¿ç”¨æ›´æ–°åŠŸèƒ½` |

### éªŒè¯é€šè¿‡åçš„ç¡®è®¤ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ“ éªŒè¯é€šè¿‡                                     â”‚
â”‚                                                 â”‚
â”‚  moraya-wordcount           v0.3.0              â”‚
â”‚  Advanced Word Count Â· Jane Doe Â· MIT           â”‚
â”‚  æ¥æºï¼šgithub.com/jane-doe/moraya-wordcount      â”‚
â”‚  âš ï¸  æœªæ”¶å½•äºå®˜æ–¹æ’ä»¶å¸‚åœºï¼ˆéè®¤è¯æ’ä»¶ï¼‰          â”‚
â”‚                                                 â”‚
â”‚  æ‰€éœ€æƒé™                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ editor:read  è¯»å–å½“å‰æ–‡æ¡£å†…å®¹           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚
â”‚  [å–æ¶ˆ]                          [ç¡®è®¤å®‰è£…]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

æœªæ”¶å½•äºå®˜æ–¹å¸‚åœºçš„æ’ä»¶æ˜¾ç¤ºã€Œéè®¤è¯æ’ä»¶ã€æç¤ºï¼Œä½†ä¸é˜»æ­¢å®‰è£…ï¼Œç”±ç”¨æˆ·åˆ¤æ–­é£é™©ã€‚

---

## F9ï¼šå®˜æ–¹ç¤ºä¾‹æ’ä»¶ï¼ˆmoraya-helloï¼‰

æ–°å»ºç‹¬ç«‹ä»“åº“ `github.com/moraya-apps/moraya-hello`ï¼Œä½œä¸ºæ’ä»¶å¼€å‘çš„èµ·ç‚¹æ¨¡æ¿ã€‚

### åŠŸèƒ½

- å“åº” `moraya.ping` / `moraya.getVersion`
- é€šè¿‡ `moraya.ui.showNotification` å±•ç¤º Toast
- é€šè¿‡ `moraya.editor.getContent` è¯»å–æ–‡æ¡£å†…å®¹å¹¶æ‰“å°

### ä»“åº“ç»“æ„

```
moraya-hello/
â”œâ”€â”€ plugin.json              â† Moraya æ’ä»¶ Manifest
â”œâ”€â”€ src/
â”‚   â””â”€â”€ main.rs              â† Rust å®ç°ï¼ˆJSON-RPC stdio é€šä¿¡ï¼‰
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ release.yml      â† ä¸‰å¹³å°äº¤å‰ç¼–è¯‘ + zip æ‰“åŒ… CI
â””â”€â”€ README.md                â† æ’ä»¶å¼€å‘æ–‡æ¡£
```

### GitHub Actionsï¼ˆrelease.yml æ ¸å¿ƒé€»è¾‘ï¼‰

```yaml
strategy:
  matrix:
    include:
      - target: aarch64-apple-darwin
        os: macos-latest
        zip_name: moraya-hello-macos-arm64.zip
      - target: x86_64-apple-darwin
        os: macos-latest
        zip_name: moraya-hello-macos-x64.zip
      - target: x86_64-pc-windows-msvc
        os: windows-latest
        zip_name: moraya-hello-windows.zip
      - target: x86_64-unknown-linux-gnu
        os: ubuntu-latest
        zip_name: moraya-hello-linux.zip
steps:
  - cargo build --release --target ${{ matrix.target }}
  - zip -j ${{ matrix.zip_name }} target/.../moraya-hello plugin.json
  - sha256sum ${{ matrix.zip_name }}  # è¾“å‡ºä¾›æ³¨å†Œè¡¨ PR ä½¿ç”¨
```

CI è‡ªåŠ¨è¾“å‡ºå„å¹³å° SHA256ï¼Œå¼€å‘è€…å¤åˆ¶åˆ°æ³¨å†Œè¡¨ PR ä¸­å³å¯ã€‚

---

## å®‰å…¨è®¾è®¡æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ³¨å†Œè¡¨å±‚                                              â”‚
â”‚  â”œâ”€â”€ åªæœ‰å®¡æ ¸é€šè¿‡çš„ç‰ˆæœ¬è¿›å…¥ï¼ˆPR é©±åŠ¨ï¼‰                 â”‚
â”‚  â”œâ”€â”€ SHA256 å“ˆå¸Œé”å®šæ¯ä¸ª release æ–‡ä»¶                  â”‚
â”‚  â””â”€â”€ blacklist.json å¿«é€Ÿä¸‹æ¶æ¶æ„æ’ä»¶                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å®‰è£…å±‚                                                â”‚
â”‚  â”œâ”€â”€ ä¸‹è½½åå¼ºåˆ¶ SHA256 æ ¡éªŒ                            â”‚
â”‚  â”œâ”€â”€ plugin.json åˆæ³•æ€§éªŒè¯ï¼ˆæœªçŸ¥æƒé™ â†’ æ‹’ç»ï¼‰         â”‚
â”‚  â”œâ”€â”€ Zip Slip è·¯å¾„ç©¿è¶Šé˜²æŠ¤                             â”‚
â”‚  â””â”€â”€ æ•æ„Ÿæƒé™éœ€ç”¨æˆ·å¼¹æ¡†æˆæƒ                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  è¿è¡Œæ—¶å±‚                                              â”‚
â”‚  â”œâ”€â”€ API Key æ°¸ä¸æš´éœ²ç»™æ’ä»¶è¿›ç¨‹                        â”‚
â”‚  â”œâ”€â”€ AI Token è°ƒç”¨é™é¢å¼ºåˆ¶æ‰§è¡Œ                         â”‚
â”‚  â”œâ”€â”€ AI ä½¿ç”¨è®°å½•å¯¹ç”¨æˆ·å¯è§                             â”‚
â”‚  â””â”€â”€ é»‘åå•å‘½ä¸­ â†’ å¼ºåˆ¶åœç”¨ + é¡¶éƒ¨è­¦å‘Š                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ–‡ä»¶æ”¹åŠ¨æ¸…å•

### å‰ç«¯

| æ–‡ä»¶ | æ”¹åŠ¨ |
|------|------|
| `src/lib/services/plugin/types.ts` | **æ–°å»º**ï¼šPluginManifestã€InstalledPluginã€RegistryEntryã€RegistryDataã€ValidationResult ç­‰ç±»å‹ |
| `src/lib/services/plugin/plugin-manager.ts` | **æ–°å»º**ï¼šSvelte storeï¼Œå°è£… plugin_list / plugin_enable / plugin_disable / plugin_uninstall / plugin_install_* / plugin_registry_fetch |
| `src/lib/services/plugin/index.ts` | **æ–°å»º**ï¼šbarrel export |
| `src/lib/components/PluginsPanel.svelte` | **æ–°å»º**ï¼šè®¾ç½® Tab å†…å®¹ï¼ˆå·²å®‰è£… + æµè§ˆå¸‚åœº + è¯¦æƒ…ä¾§æ»‘ï¼‰|
| `src/lib/components/SettingsPanel.svelte` | æ–°å¢ `plugin` Tabï¼Œå¼•å…¥ PluginsPanel |
| `src/lib/i18n/locales/en.json` | æ–°å¢ `settings.plugins.*` å›½é™…åŒ–é”® |
| `src/lib/i18n/locales/zh-CN.json` | æ–°å¢ `settings.plugins.*` å›½é™…åŒ–é”® |

### Rust åç«¯

| æ–‡ä»¶ | æ”¹åŠ¨ |
|------|------|
| `src-tauri/src/commands/plugin_manager.rs` | **æ–°å»º**ï¼šPluginProcessManager + å…¨éƒ¨ plugin_* å‘½ä»¤å®ç°ï¼ˆ~500 è¡Œï¼Œfork è‡ª mcp.rsï¼‰|
| `src-tauri/src/commands/mod.rs` | æ–°å¢ `pub mod plugin_manager` |
| `src-tauri/src/lib.rs` | æ³¨å†Œå…¨éƒ¨ plugin_* å‘½ä»¤ |
| `src-tauri/Cargo.toml` | æ–°å¢ `sha2`ï¼ˆSHA256 è®¡ç®—ï¼‰ã€`zip`ï¼ˆè§£å‹ï¼‰ä¾èµ– |
| `src-tauri/capabilities/default.json` | ç¡®è®¤å·²æœ‰ `fs:scope-appdata-recursive` æƒé™ï¼ˆplugin ç›®å½•åœ¨ appData å†…ï¼‰|

### æ–‡æ¡£ & ç‰ˆæœ¬

| æ–‡ä»¶ | æ”¹åŠ¨ |
|------|------|
| `docs/iterations/v0.16.0-plugin-system.md` | **æ–°å»º**ï¼šæœ¬æ–‡æ¡£ |
| `README.md` | Development Roadmap æ–°å¢ v0.16.0 ä¸€è¡Œæ‘˜è¦ + é“¾æ¥ |
| `package.json` | ç‰ˆæœ¬å· bump è‡³ 0.16.0 |
| `src-tauri/Cargo.toml` | ç‰ˆæœ¬å· bump è‡³ 0.16.0 |
| `src-tauri/tauri.conf.json` | ç‰ˆæœ¬å· bump è‡³ 0.16.0 |

### æ–°å»ºå¤–éƒ¨ä»“åº“

| ä»“åº“ | è¯´æ˜ |
|------|------|
| `moraya-apps/moraya-plugin-registry` | æ’ä»¶æ³¨å†Œè¡¨ï¼ˆindex.json + blacklist.jsonï¼‰|
| `moraya-apps/moraya-hello` | å®˜æ–¹ç¤ºä¾‹æ’ä»¶ + å¼€å‘æ¨¡æ¿ |

---

## å®æ–½é¡ºåº

1. **ç‰ˆæœ¬å· bump** â†’ 0.16.0ï¼ˆpackage.json / Cargo.toml / tauri.conf.jsonï¼‰
2. **F1** â†’ å®šä¹‰ plugin/types.ts å…¨éƒ¨ç±»å‹
3. **F2** â†’ å®ç° plugin_manager.rsï¼ˆä» mcp.rs forkï¼Œæ·»åŠ  SHA256 + Zip Slip é˜²æŠ¤ï¼‰
4. **F2** â†’ æ³¨å†Œå‘½ä»¤åˆ° lib.rsï¼Œcargo check éªŒè¯
5. **F4** â†’ å®ç° PluginsPanel.svelte å·²å®‰è£…è§†å›¾ï¼ˆplugin_list / enable / disable / uninstallï¼‰
6. **F8** â†’ å®ç° plugin_validate_manifest å‘½ä»¤
7. **F7** â†’ å®ç°æœ¬åœ° zip å®‰è£…æµç¨‹ï¼ˆplugin_install_localï¼‰ï¼Œå«åˆæ³•æ€§éªŒè¯
8. **F6** â†’ å®ç° plugin_registry_fetch å‘½ä»¤ï¼ˆGitHub API å¹¶å‘æ‹‰å– + ç¼“å­˜ï¼‰
9. **F5** â†’ å®ç° PluginsPanel.svelte å¸‚åœºæµè§ˆè§†å›¾
10. **F6+F7** â†’ å®ç°åœ¨çº¿ä¸€é”®å®‰è£…æµç¨‹ï¼ˆplugin_install_from_urlï¼‰
11. **F3** â†’ å®ç° Plugin API JSON-RPC è·¯ç”±ï¼ˆplugin_invoke åˆ†å‘åˆ°å„ API handlerï¼‰
12. **F3** â†’ å®ç° AI æ‰“é€šï¼ˆai.chat / ai.image / ai.voice proxy handlerï¼‰
13. **F9** â†’ åˆ›å»º moraya-hello ç¤ºä¾‹æ’ä»¶ä»“åº“ + CI
14. **æ³¨å†Œè¡¨** â†’ åˆ›å»º moraya-plugin-registry ä»“åº“ï¼Œå½•å…¥ moraya-hello
15. **i18n** â†’ è¡¥å…¨ en.json / zh-CN.json æ’ä»¶ç›¸å…³ç¿»è¯‘é”®
16. **è”è°ƒ** â†’ moraya-hello å®Œæ•´å®‰è£… â†’ å¯ç”¨ â†’ API è°ƒç”¨ â†’ å¸è½½æµç¨‹éªŒè¯

---

## å·²çŸ¥é™åˆ¶

- **äºŒè¿›åˆ¶æ’ä»¶æ— æ³•å®Œå…¨é˜»æ­¢å¤–éƒ¨ç½‘ç»œè®¿é—®**ï¼šåŸç”ŸäºŒè¿›åˆ¶è¿›ç¨‹åœ¨ OS å±‚é¢å¯å‘èµ·ä»»æ„ TCP è¿æ¥ï¼ŒSHA256 ç‰ˆæœ¬é”å®š + `net:external` å£°æ˜åˆ¶æ˜¯ç›®å‰å¯è¡Œçš„æœ€ä¼˜è§£ã€‚æœªæ¥ `sandbox` çº§ JS æ’ä»¶å¯å®ç°çœŸæ­£çš„ç½‘ç»œéš”ç¦»ã€‚
- **GitHub API é€Ÿç‡é™åˆ¶**ï¼šæœªè®¤è¯ 60æ¬¡/å°æ—¶/IPï¼Œå¤šæ’ä»¶å¹¶å‘æ‹‰å–æ—¶å¯èƒ½è§¦å‘é™æµã€‚ç¼“å­˜æœºåˆ¶å¯ç¼“è§£ï¼Œä½†æ— æ³•å®Œå…¨æ¶ˆé™¤ã€‚
- **é»‘åå•æ›´æ–°å»¶è¿Ÿ**ï¼šé»‘åå•åœ¨ Moraya å¯åŠ¨æ—¶æ‹‰å–ï¼Œä¸­é€”æ–°å¢çš„æ¶æ„æ’ä»¶éœ€ç­‰åˆ°ä¸‹æ¬¡å¯åŠ¨æ‰ç”Ÿæ•ˆã€‚
- **Windows è¿›ç¨‹éš”ç¦»**ï¼šå½“å‰å¤ç”¨ Unix è¿›ç¨‹ç»„æ–¹æ¡ˆï¼ŒWindows Job Object éš”ç¦»åœ¨ v0.16.1 è¡¥å……ã€‚
- **`sandbox` çº§ JS æ’ä»¶**ï¼šæœ¬ç‰ˆæœ¬ä»…å®ç° `local` å’Œ `system` çº§åŸç”ŸäºŒè¿›åˆ¶æ’ä»¶ï¼ŒJS æ²™ç®±æ’ä»¶è§„åˆ’è‡³åç»­ç‰ˆæœ¬ã€‚

---

## éªŒè¯æ–¹æ¡ˆ

éªŒè¯åˆ†ä¸¤ä¸ªé˜¶æ®µè¿›è¡Œï¼š**é˜¶æ®µä¸€**ä½¿ç”¨æ‰‹åŠ¨æ„é€ çš„æµ‹è¯•å¤¹å…· zipï¼ˆåœ¨ moraya-hello å®ç°ä¹‹å‰å¯ç«‹å³æ‰§è¡Œï¼‰ï¼›**é˜¶æ®µäºŒ**åœ¨ moraya-hello åˆ›å»ºåï¼ˆå®æ–½æ­¥éª¤ 13ï¼‰æ‰§è¡Œå®Œæ•´ç«¯åˆ°ç«¯éªŒè¯ã€‚

### é˜¶æ®µä¸€ï¼šæµ‹è¯•å¤¹å…·ï¼ˆå®æ–½æ­¥éª¤ 1-12 æœŸé—´ï¼‰

æ„é€ æœ€ç®€ fixture zipï¼ˆæ— éœ€çœŸå® JSON-RPC å®ç°ï¼‰ï¼š

```bash
mkdir -p test-plugin/bin
# å†™å…¥åˆæ³• plugin.jsonï¼ˆpermissions: [], sandboxLevel: "local"ï¼‰
echo '#!/bin/sh' > test-plugin/bin/plugin && chmod +x test-plugin/bin/plugin
cd test-plugin && zip -r ../moraya-test-fixture.zip .
shasum -a 256 moraya-test-fixture.zip   # è®°å½• SHA256 ä¾›æµ‹è¯•ç”¨
```

| åŠŸèƒ½ | éªŒè¯æ­¥éª¤ |
|------|---------|
| **æœ¬åœ°å®‰è£…ï¼ˆåˆæ³•æ’ä»¶ï¼‰** | ä½¿ç”¨ moraya-test-fixture.zip â†’ æ‹–å…¥å®‰è£… â†’ éªŒè¯é€šè¿‡ â†’ å‡ºç°åœ¨å·²å®‰è£…åˆ—è¡¨ |
| **æœ¬åœ°å®‰è£…ï¼ˆéæ³•æ’ä»¶ï¼‰** | æ„é€ å« `"permissions": ["unknown:perm"]` çš„ zip â†’ å®‰è£…è¢«æ‹’ç»ï¼Œæ˜¾ç¤ºå…·ä½“é”™è¯¯ |
| **SHA256 æ ¡éªŒ** | åœ¨ zip æœ«å°¾è¿½åŠ ä»»æ„å­—èŠ‚ä½¿å“ˆå¸Œæ”¹å˜ â†’ å®‰è£…æ—¶æç¤ºã€Œæ–‡ä»¶å®Œæ•´æ€§éªŒè¯å¤±è´¥ã€|
| **Zip Slip é˜²æŠ¤** | æ„é€ å« `../../../etc/passwd` æ¡ç›®çš„ zip â†’ å®‰è£…æ—¶è¢«æ‹’ç» |
| **å·²å®‰è£…ç®¡ç†** | enable / disable / uninstall å„æ“ä½œï¼ŒçŠ¶æ€æŒä¹…åŒ–éªŒè¯ï¼ˆé‡å¯åä»æ­£ç¡®ï¼‰|
| **é»‘åå•** | æ‰‹åŠ¨å°† `moraya-test-fixture` åŠ å…¥æœ¬åœ° blacklist.json â†’ é‡å¯åå¼ºåˆ¶åœç”¨ + è­¦å‘Š |
| **å¸‚åœºåŠ¨æ€æ•°æ®** | æ‰“å¼€å¸‚åœº â†’ å±•ç¤º GitHub stars/ç‰ˆæœ¬/æè¿°ï¼ˆéæœ¬åœ°é™æ€æ•°æ®ï¼‰|
| **ç¼“å­˜æœºåˆ¶** | æ–­ç½‘åæ‰“å¼€å¸‚åœº â†’ å±•ç¤ºç¼“å­˜æ•°æ® + æç¤ºæ–‡å­—ã€Œä½¿ç”¨ç¼“å­˜æ•°æ®ã€|
| **URL å¯¼å…¥éªŒè¯ï¼ˆå¤±è´¥ï¼‰** | è¾“å…¥é Moraya æ’ä»¶çš„ GitHub URL â†’ éªŒè¯å¤±è´¥ï¼Œæ˜¾ç¤ºå…·ä½“åŸå›  |
| **URL å¯¼å…¥éªŒè¯ï¼ˆé€šè¿‡ï¼‰** | è¾“å…¥ moraya-apps/moraya-hello URL â†’ éªŒè¯é€šè¿‡ï¼Œè¿›å…¥å®‰è£…ç¡®è®¤ç•Œé¢ |

### é˜¶æ®µäºŒï¼šmoraya-hello å®Œæ•´éªŒè¯ï¼ˆå®æ–½æ­¥éª¤ 13 ä¹‹åï¼‰

| åŠŸèƒ½ | éªŒè¯æ­¥éª¤ |
|------|---------|
| **åœ¨çº¿ä¸€é”®å®‰è£…** | æ‰“å¼€å¸‚åœº â†’ æ‰¾åˆ° moraya-hello â†’ ç‚¹å‡»å®‰è£… â†’ å®Œæ•´ä¸‹è½½â†’éªŒè¯â†’å®‰è£…æµç¨‹ |
| **è¿›ç¨‹é€šä¿¡** | å¯ç”¨ moraya-hello â†’ Moraya å‘å…¶å‘é€ ping â†’ è¿”å› pong |
| **AI æ‰“é€šï¼ˆchat åŒæ­¥ï¼‰** | moraya-hello è°ƒç”¨ `moraya.ai.chat.complete` â†’ è¿”å›æ­£ç¡®å†…å®¹ |
| **AI æ‰“é€šï¼ˆchat æµå¼ï¼‰** | è°ƒç”¨ `moraya.ai.chat.stream` â†’ `ai.chat.onChunk` äº‹ä»¶æŒç»­æ¨é€ï¼Œ`done: true` åç»“æŸ |
| **AI Token é™é¢** | åœ¨ plugin.json è®¾ç½® `callsPerMinute: 1` â†’ å¿«é€Ÿè°ƒç”¨ä¸¤æ¬¡ â†’ ç¬¬äºŒæ¬¡è¿”å› `rate_limit_exceeded` |
| **ç¼–è¾‘å™¨ API** | moraya-hello è°ƒç”¨ `moraya.editor.getContent` â†’ è¿”å›å½“å‰æ–‡æ¡£å†…å®¹ |
| **UI API** | moraya-hello è°ƒç”¨ `moraya.ui.showNotification` â†’ ç•Œé¢å‡ºç° Toast |
