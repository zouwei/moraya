# v0.8.0 iPhone Adaptation

> åœ¨ v0.7.0 iPadOS é€‚é…åŸºç¡€ä¸Šï¼Œè¿›ä¸€æ­¥æ”¯æŒ iPhone è®¾å¤‡ã€‚æ ¸å¿ƒæŒ‘æˆ˜æ˜¯çª„å±å¸ƒå±€é‡æ’â€”â€”Sidebarã€AI é¢æ¿ã€Split æ¨¡å¼éœ€è¦ä»ä¾§è¾¹æ è½¬ä¸ºæŠ½å±‰/åº•éƒ¨å¼¹å‡ºã€‚Rust åç«¯é›¶æ”¹åŠ¨ï¼Œ70%+ å‰ç«¯ä»£ç å¯ç›´æ¥å¤ç”¨ã€‚

## éœ€æ±‚èƒŒæ™¯

v0.7.0 å®Œæˆäº† iPadOS é€‚é…ï¼ˆTab æ ã€TouchToolbarã€è™šæ‹Ÿé”®ç›˜å¤„ç†ã€è§¦æ§äº¤äº’ï¼‰ï¼Œä½†ç›®æ ‡è®¾å¤‡é™å®šä¸º iPadï¼ˆ`UIDeviceFamily: [2]`ï¼Œ`TARGETED_DEVICE_FAMILY: "2"`ï¼‰ã€‚

iPhone ä¸ iPad å…±äº« `target_os = "ios"` ç¼–è¯‘ç›®æ ‡å’Œç»å¤§éƒ¨åˆ† Tauri è¿è¡Œæ—¶è¡Œä¸ºï¼Œå› æ­¤ Rust åç«¯æ— éœ€æ”¹åŠ¨ã€‚ä¸»è¦å·¥ä½œé›†ä¸­åœ¨å‰ç«¯å“åº”å¼å¸ƒå±€ï¼š

| å¯¹æ¯”é¡¹ | iPad | iPhone |
|--------|------|--------|
| å±å¹•å®½åº¦ | 1024-1366px | 375-430pxï¼ˆç«–å±ï¼‰ |
| å±å¹•æ–¹å‘ | æ¨ªå±ä¸ºä¸» | ç«–å±ä¸ºä¸» |
| Sidebar 260px | ä¾§è¾¹æ å¯å¸¸é©» | è¶…è¿‡å±å®½ï¼Œå¿…é¡»æŠ˜å  |
| AI é¢æ¿ 340px | å³ä¾§æ å¯ç”¨ | è¶…è¿‡å±å®½ï¼Œå¿…é¡»æŠ˜å  |
| Split æ¨¡å¼ | æ¨ªå±å¯ç”¨ | ç«–å±ä¸å¯ç”¨ |
| è§¦æ§äº¤äº’ | å·²é€‚é…ï¼ˆv0.7.0ï¼‰ | å®Œå…¨å¤ç”¨ |
| MCP stdio | å·²ç¦ç”¨ï¼ˆv0.7.0ï¼‰ | å®Œå…¨å¤ç”¨ |

## å…³é”®å†³ç­–

| å†³ç­–é¡¹ | é€‰æ‹© | ç†ç”± |
|--------|------|------|
| Bundle ç­–ç•¥ | ç»Ÿä¸€ IPAï¼ˆiPad + iPhoneï¼‰ | å…±ç”¨ Bundle ID `com.moraya.app`ï¼ŒApp Store ä¸å…è®¸åŒ ID ä¸Šæ¶ä¸¤ä¸ª App |
| Sidebar | æŠ½å±‰å¼å¯¼èˆªï¼ˆDrawerï¼‰ | iPhone ç«–å±ä»… 375-430pxï¼Œ260px ä¾§è¾¹æ å¸¸é©»ä¸å¯è¡Œ |
| AI èŠå¤©é¢æ¿ | åº•éƒ¨æŠ½å±‰ï¼ˆBottomSheetï¼‰ | ç«–å±ä¸‹å³ä¾§é¢æ¿ä¸å¯è¡Œï¼Œåº•éƒ¨æŠ½å±‰æ˜¯ iOS æ ‡å‡†äº¤äº’æ¨¡å¼ |
| Settings | å…¨å± Sheet | iPhone ç«–å±ä¸‹æ¨¡æ€å¼¹çª—ç©ºé—´ä¸è¶³ï¼Œæ”¹ä¸ºå…¨å± |
| Split æ¨¡å¼ | ç«–å±ç¦ç”¨ | `width < 600px` æ—¶å¹¶æ’ä¸å¯è¯»ï¼Œè‡ªåŠ¨åˆ‡å› Visual |
| å¹³å° CSS class | `platform-iphone` | ä¸ `platform-ipados` åˆ†ç¦»ï¼ŒiPhone ä¸“å±æ ·å¼äº’ä¸å¹²æ‰° |
| æ–­ç‚¹ç­–ç•¥ | `max-width: 600px` | è¦†ç›–æ‰€æœ‰ iPhone ç«–å± + iPad 1/3 åˆ†å± |

## éš”ç¦»ç­–ç•¥ï¼šä¸å½±å“å·²å‘å¸ƒç‰ˆæœ¬

**æ ¸å¿ƒåŸåˆ™**ï¼šæ‰€æœ‰ iPhone é€‚é…ä»£ç é€šè¿‡æ¡ä»¶åˆ†æ”¯æ§åˆ¶ï¼Œå·²æœ‰æ¡Œé¢ç«¯å’Œ iPad ç«¯é€»è¾‘ä¸åšä¿®æ”¹ã€‚

| éš”ç¦»æœºåˆ¶ | å®ç°æ–¹å¼ | å½±å“èŒƒå›´ |
|---------|----------|---------|
| **Rust åç«¯** | æ— æ”¹åŠ¨ã€‚`#[cfg(not(target_os = "ios"))]` å·²è¦†ç›–å…¨éƒ¨ iOS è®¾å¤‡ | é›¶é£é™© |
| **CSS æ ·å¼** | ä½¿ç”¨ `:global(.platform-iphone)` å’Œ `@media (max-width: 600px)` éš”ç¦» | ä¸å½±å“æ¡Œé¢å’Œ iPad |
| **ç»„ä»¶æ¸²æŸ“** | ä½¿ç”¨ `isIPhoneOS` æ¡ä»¶åˆ†æ”¯æ§åˆ¶ Drawer/BottomSheet æ¸²æŸ“ | æ¡Œé¢/iPad èµ°åŸæœ‰è·¯å¾„ |
| **æ–°ç»„ä»¶** | `DrawerNavigation.svelte` å’Œ `BottomSheet.svelte` ä»…åœ¨ iPhone ä¸ŠæŒ‚è½½ | ä¸åŠ è½½åˆ°æ¡Œé¢/iPad |
| **Xcode é¡¹ç›®** | ä»…ä¿®æ”¹ `UIDeviceFamily` å’Œ `TARGETED_DEVICE_FAMILY` é…ç½® | ä¸å½±å“ç¼–è¯‘äº§ç‰©é€»è¾‘ |
| **CI/CD** | `release-ios` Job äº§ç‰©ä» iPad-only IPA å˜ä¸º Universal IPA | åŒä¸€ IPA åŒæ—¶æ”¯æŒ iPad+iPhone |
| **æ¡Œé¢æ„å»º** | `pnpm tauri build` æµç¨‹å®Œå…¨ä¸å˜ | é›¶å½±å“ |

**éªŒè¯æœºåˆ¶**ï¼šæ¯ä¸ª Phase å®Œæˆåï¼Œå¿…é¡»éªŒè¯æ¡Œé¢ç«¯ `pnpm tauri dev` å’Œ iPad æ¨¡æ‹Ÿå™¨ `pnpm tauri ios dev "iPad Air"` åŠŸèƒ½ä¸å—å½±å“ã€‚

---

## åŠŸèƒ½åˆ—è¡¨

### F8.1 iPhone å¹³å°æ£€æµ‹ä¸è®¾å¤‡ç›®æ ‡æ‰©å±•

**ç›®æ ‡**ï¼šæ‰©å±•å¹³å°æ£€æµ‹ï¼Œæ”¯æŒ iPhone è¯†åˆ«ï¼›ä¿®æ”¹ Xcode é¡¹ç›®é…ç½®ï¼Œæ„å»ºé€šç”¨ iOS IPAã€‚

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š

1. **å¹³å°æ£€æµ‹æ‰©å±•** â€” `src/lib/utils/platform.ts`
   ```typescript
   /** Running on iPhone (not iPad) */
   export const isIPhoneOS: boolean =
     !isIPadOS && (ua.includes('iphone') || /\biOS\b/i.test(ua));

   /** Dev-only override: ?iphone=1 in URL */
   const forceIPhone: boolean =
     typeof window !== 'undefined' &&
     new URLSearchParams(window.location.search).get('iphone') === '1';
   ```
   - `getPlatformClass()` æ–°å¢ `'platform-iphone'` è¿”å›å€¼
   - `isVirtualKeyboardVisible()` æ¡ä»¶ä» `isIPadOS` æ‰©å±•ä¸º `isIOS`
   - æ–°å¢ `isNarrowScreen()` å·¥å…·å‡½æ•°ï¼š`window.innerWidth < 600`

2. **Xcode è®¾å¤‡ç›®æ ‡** â€” ä¿®æ”¹ä¸¤å¤„é…ç½®ï¼š
   - `src-tauri/gen/apple/moraya_iOS/Info.plist`ï¼š`UIDeviceFamily` ä» `[2]` æ”¹ä¸º `[1, 2]`
   - `src-tauri/gen/apple/project.yml`ï¼š`TARGETED_DEVICE_FAMILY` ä» `"2"` æ”¹ä¸º `"1,2"`

3. **iPhone CSS class æ³¨å…¥** â€” `src/routes/+page.svelte`
   - æ ¹æ® `getPlatformClass()` è¿”å›å€¼è®¾ç½® `document.body.classList`

**ä¸å½±å“ç°æœ‰åŠŸèƒ½**ï¼š
- `isIPadOS` / `isMacOS` ç­‰å¸¸é‡ä¸å˜ï¼Œç°æœ‰æ¡ä»¶åˆ†æ”¯ä¸å—å½±å“
- Xcode `TARGETED_DEVICE_FAMILY: "1,2"` æ˜¯è¶…é›†ï¼ŒiPad æ„å»ºè¡Œä¸ºä¸å˜

**æ¶‰åŠæ–‡ä»¶**ï¼š
- `src/lib/utils/platform.ts` â€” æ–°å¢ `isIPhoneOS`ã€`isNarrowScreen()`ã€æ‰©å±• `getPlatformClass()`
- `src/routes/+page.svelte` â€” å¹³å° class æ³¨å…¥
- `src-tauri/gen/apple/moraya_iOS/Info.plist` â€” UIDeviceFamily
- `src-tauri/gen/apple/project.yml` â€” TARGETED_DEVICE_FAMILY

---

### F8.2 å“åº”å¼æ–­ç‚¹ä¸ CSS å˜é‡

**ç›®æ ‡**ï¼šå»ºç«‹ iPhone ç«–å±å“åº”å¼åŸºç¡€ï¼Œå®šä¹‰çª„å±æ–­ç‚¹ä¸ CSS å˜é‡ã€‚

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š

1. **CSS å˜é‡æ‰©å±•** â€” `src/lib/styles/variables.css`
   ```css
   /* iPhone narrow screen overrides */
   .platform-iphone {
     --sidebar-width: 0px;     /* é»˜è®¤éšè— Sidebar */
     --statusbar-height: 36px; /* ç•¥çŸ®äº iPad 40px */
   }
   ```

2. **å…¨å±€å“åº”å¼åª’ä½“æŸ¥è¯¢** â€” `src/lib/styles/global.css`
   ```css
   /* iPhone portrait: additional touch-friendly adjustments */
   @media (max-width: 600px) and (hover: none) {
     /* çª„å±è§¦æ§è®¾å¤‡ä¸“å±æ ·å¼ */
   }
   ```

3. **Safe Area å¤„ç†**
   - iPhone åˆ˜æµ· / Dynamic Islandï¼š`padding-top: env(safe-area-inset-top)`
   - åº•éƒ¨ Home Indicatorï¼š`padding-bottom: env(safe-area-inset-bottom)`
   - TitleBar å’Œ StatusBar å·²æœ‰ safe-area å¤„ç†ï¼ˆv0.7.0ï¼‰ï¼Œå¤ç”¨å³å¯

**ä¸å½±å“ç°æœ‰åŠŸèƒ½**ï¼š
- æ–°å¢çš„ `.platform-iphone` CSS é€‰æ‹©å™¨ä»…åŒ¹é… iPhoneï¼Œæ¡Œé¢å’Œ iPad ä¸å—å½±å“
- `@media (max-width: 600px)` å¯¹æ¡Œé¢ç«¯æ— å½±å“ï¼ˆæ¡Œé¢çª—å£é€šå¸¸ > 600pxï¼‰

**æ¶‰åŠæ–‡ä»¶**ï¼š
- `src/lib/styles/variables.css` â€” iPhone å˜é‡è¦†ç›–
- `src/lib/styles/global.css` â€” çª„å±åª’ä½“æŸ¥è¯¢

---

### F8.3 Sidebar æŠ½å±‰å¼å¯¼èˆª

**ç›®æ ‡**ï¼šiPhone ä¸Šå°†å›ºå®š Sidebar æ›¿æ¢ä¸ºå¯åˆ‡æ¢çš„å…¨å±æŠ½å±‰å¯¼èˆªã€‚

**UI è®¾è®¡**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TitleBar  [â˜°]  [...] â”‚     â”‚ â† æ–‡ä»¶æµè§ˆ           â”‚
â”‚ TabBar               â”‚ tap â”‚                      â”‚
â”‚                      â”‚ â”€â”€â†’ â”‚  ğŸ“ Documents        â”‚
â”‚   Editor Area        â”‚     â”‚    ğŸ“„ note.md        â”‚
â”‚                      â”‚     â”‚    ğŸ“„ draft.md        â”‚
â”‚ TouchToolbar         â”‚     â”‚    ğŸ“ archive/        â”‚
â”‚ StatusBar            â”‚     â”‚                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    ç¼–è¾‘çŠ¶æ€                     æŠ½å±‰æ‰“å¼€çŠ¶æ€
```

**äº¤äº’**ï¼š
- TitleBar å·¦ä¾§æ–°å¢ "â˜°" æ±‰å ¡èœå•æŒ‰é’®ï¼ˆä»… iPhone æ˜¾ç¤ºï¼‰
- ç‚¹å‡» â†’ ä»å·¦ä¾§æ»‘å…¥å…¨å±æŠ½å±‰ï¼ˆå®½åº¦ 85vwï¼Œæœ€å¤§ 360pxï¼‰
- æŠ½å±‰å†…å®¹å¤ç”¨ `Sidebar.svelte` çš„æ–‡ä»¶æ ‘ç»„ä»¶
- ç‚¹å‡»æ–‡ä»¶ â†’ å…³é—­æŠ½å±‰ + åœ¨å½“å‰ Tab æ‰“å¼€ï¼ˆæˆ–æ–°å»º Tabï¼‰
- ç‚¹å‡»é®ç½© / å‘å·¦æ»‘åŠ¨ â†’ å…³é—­æŠ½å±‰
- è¿‡æ¸¡åŠ¨ç”»ï¼š`transform: translateX()` + `backdrop opacity`

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š

1. **æ–°å»º `src/lib/components/DrawerNavigation.svelte`**
   ```svelte
   <script lang="ts">
     let { open = $bindable(false), onSelectFile }: Props = $props();
   </script>

   {#if open}
     <div class="drawer-backdrop" onclick={() => open = false}>
       <div class="drawer-panel" onclick={(e) => e.stopPropagation()}>
         <!-- å¤ç”¨ Sidebar æ–‡ä»¶æ ‘ -->
       </div>
     </div>
   {/if}
   ```

2. **TitleBar æ¡ä»¶æ¸²æŸ“** â€” `src/lib/components/TitleBar.svelte`
   ```css
   :global(.platform-iphone) .hamburger-btn { display: flex; }
   ```
   - ä»… iPhone æ˜¾ç¤ºæ±‰å ¡æŒ‰é’®ï¼Œæ¡Œé¢/iPad ä¸æ˜¾ç¤º

3. **`+page.svelte` é›†æˆ**
   - iPhone ä¸Šéšè—å¸¸é©» Sidebarï¼Œæ›¿æ¢ä¸º DrawerNavigation
   - æ¡ä»¶ï¼š`if (isIPhoneOS) { /* æ¸²æŸ“ Drawer */ } else { /* ä¿æŒç°æœ‰ Sidebar */ }`

**ä¸å½±å“ç°æœ‰åŠŸèƒ½**ï¼š
- æ¡Œé¢ç«¯å’Œ iPad ç«¯çš„ Sidebar ç»„ä»¶å’Œæ˜¾ç¤ºé€»è¾‘å®Œå…¨ä¸å˜
- DrawerNavigation ä»…åœ¨ `isIPhoneOS` ä¸º true æ—¶æŒ‚è½½
- TitleBar æ±‰å ¡æŒ‰é’®é€šè¿‡ `.platform-iphone` CSS æ§åˆ¶ï¼Œä¸å½±å“å…¶ä»–å¹³å°

**æ¶‰åŠæ–‡ä»¶**ï¼š
- `src/lib/components/DrawerNavigation.svelte` â€” **æ–°å»º**
- `src/lib/components/TitleBar.svelte` â€” æ·»åŠ æ±‰å ¡æŒ‰é’®ï¼ˆiPhone æ¡ä»¶æ¸²æŸ“ï¼‰
- `src/routes/+page.svelte` â€” Sidebar/Drawer æ¡ä»¶åˆ‡æ¢

---

### F8.4 AI èŠå¤©é¢æ¿åº•éƒ¨æŠ½å±‰

**ç›®æ ‡**ï¼šiPhone ä¸Šå°†å³ä¾§ AI é¢æ¿æ›¿æ¢ä¸ºåº•éƒ¨æŠ½å±‰ï¼ˆBottomSheetï¼‰ã€‚

**UI è®¾è®¡**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TitleBar             â”‚     â”‚ AI åŠ©æ‰‹        [âœ•]   â”‚
â”‚ TabBar               â”‚ tap â”‚                      â”‚
â”‚                      â”‚ â”€â”€â†’ â”‚  å¯¹è¯å†…å®¹åŒºåŸŸ         â”‚
â”‚   Editor Area        â”‚     â”‚  ...                  â”‚
â”‚                      â”‚     â”‚                      â”‚
â”‚ TouchToolbar         â”‚     â”‚  [è¾“å…¥æ¡†]   [å‘é€]    â”‚
â”‚ StatusBar    [ğŸ¤–]    â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    StatusBar AI æŒ‰é’®            åº•éƒ¨æŠ½å±‰ï¼ˆ85vhï¼‰
```

**äº¤äº’**ï¼š
- StatusBar æ–°å¢ AI å…¥å£æŒ‰é’®ï¼ˆä»… iPhone æ˜¾ç¤ºï¼‰
- ç‚¹å‡» â†’ ä»åº•éƒ¨æ»‘å…¥æŠ½å±‰ï¼ˆé«˜åº¦ 85vhï¼Œå¯ä¸‹æ‹‰å…³é—­ï¼‰
- æŠ½å±‰å†…å®¹å¤ç”¨ `AIChatPanel.svelte` æ ¸å¿ƒé€»è¾‘
- ä¸‹æ‹‰æ‹–åŠ¨è¶…è¿‡é˜ˆå€¼ â†’ å…³é—­æŠ½å±‰
- é”®ç›˜å¼¹å‡ºæ—¶ â†’ æŠ½å±‰é«˜åº¦è‡ªåŠ¨é€‚åº”

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š

1. **æ–°å»º `src/lib/components/BottomSheet.svelte`**
   - é€šç”¨åº•éƒ¨æŠ½å±‰ç»„ä»¶ï¼Œå¯è¢« AI é¢æ¿ã€Settings ç­‰å¤ç”¨
   - Propsï¼š`open`ï¼ˆæ§åˆ¶æ˜¾éšï¼‰ã€`height`ï¼ˆé»˜è®¤ 85vhï¼‰ã€`title`
   - æ”¯æŒä¸‹æ‹‰å…³é—­æ‰‹åŠ¿ï¼ˆ`touchstart` + `touchmove` è®¡ç®—ä½ç§»ï¼‰
   - è¿‡æ¸¡åŠ¨ç”»ï¼š`transform: translateY()` + `backdrop opacity`

2. **AIChatPanel é€‚é…**
   - æ¡Œé¢/iPadï¼šä¿æŒå³ä¾§é¢æ¿å¸ƒå±€
   - iPhoneï¼šåŒ…è£¹åœ¨ BottomSheet ä¸­ï¼Œå®½åº¦ 100%

3. **StatusBar AI å…¥å£** â€” `src/lib/components/StatusBar.svelte`
   - iPhone ä¸Šæ–°å¢ AI æŒ‰é’®å›¾æ ‡
   - ç‚¹å‡»è§¦å‘ `onToggleAI` å›è°ƒ

**ä¸å½±å“ç°æœ‰åŠŸèƒ½**ï¼š
- æ¡Œé¢ç«¯å’Œ iPad ç«¯çš„ AIChatPanel æ¸²æŸ“è·¯å¾„ä¸å˜
- BottomSheet æ˜¯æ–°ç»„ä»¶ï¼Œä»…åœ¨ iPhone æ¡ä»¶ä¸‹æŒ‚è½½
- StatusBar AI æŒ‰é’®é€šè¿‡ `.platform-iphone` CSS æ§åˆ¶æ˜¾éš

**æ¶‰åŠæ–‡ä»¶**ï¼š
- `src/lib/components/BottomSheet.svelte` â€” **æ–°å»º**
- `src/lib/components/ai/AIChatPanel.svelte` â€” iPhone å¸ƒå±€é€‚é…
- `src/lib/components/StatusBar.svelte` â€” iPhone AI å…¥å£æŒ‰é’®
- `src/routes/+page.svelte` â€” AI é¢æ¿æ¡ä»¶æ¸²æŸ“

---

### F8.5 Settings å…¨å± Sheet

**ç›®æ ‡**ï¼šiPhone ä¸Šå°† Settings å¼¹çª—æ”¹ä¸ºå…¨å± Sheetã€‚

**UI è®¾è®¡**ï¼š
- æ¡Œé¢ç«¯/iPadï¼šä¿æŒç°æœ‰æ¨¡æ€å¯¹è¯æ¡†
- iPhoneï¼šå…¨å± Sheetï¼ˆé«˜åº¦ 100vhï¼Œä»åº•éƒ¨æ»‘å…¥ï¼‰
- é¡¶éƒ¨å¯¼èˆªæ ï¼šæ ‡é¢˜ + å…³é—­æŒ‰é’®
- å¤ç”¨ `BottomSheet.svelte`ï¼Œé«˜åº¦è®¾ä¸º 100vh

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š

1. **SettingsPanel æ¡ä»¶å¸ƒå±€**
   - iPhoneï¼š`<BottomSheet height="100vh">` åŒ…è£¹
   - æ¡Œé¢/iPadï¼šä¿æŒåŸæœ‰ `<div class="settings-overlay">` å¸ƒå±€

2. **Tab æ é€‚é…**
   - iPhone ç«–å±å®½åº¦ä¸è¶³ä»¥æ¨ªå‘æ’åˆ—æ‰€æœ‰ Tab
   - æ”¹ä¸ºå¯æ¨ªå‘æ»šåŠ¨çš„ Tab æ ï¼ˆç±»ä¼¼ TouchToolbarï¼‰

**ä¸å½±å“ç°æœ‰åŠŸèƒ½**ï¼š
- æ¡ä»¶æ¸²æŸ“ï¼š`{#if isIPhoneOS} <BottomSheet> {:else} <ç°æœ‰å¸ƒå±€>`
- æ¡Œé¢ç«¯å’Œ iPad ç«¯èµ° `{:else}` åˆ†æ”¯ï¼Œé€»è¾‘å®Œå…¨ä¸å˜

**æ¶‰åŠæ–‡ä»¶**ï¼š
- `src/lib/components/SettingsPanel.svelte` â€” iPhone å…¨å± Sheet å¸ƒå±€

---

### F8.6 Split æ¨¡å¼çª„å±ç¦ç”¨

**ç›®æ ‡**ï¼šiPhone ç«–å±ä¸‹ç¦ç”¨ Split æ¨¡å¼ï¼Œé˜²æ­¢ç¼–è¾‘å™¨ä¸å¯è¯»ã€‚

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š

1. **å®½åº¦æ£€æµ‹** â€” `src/routes/+page.svelte`
   ```typescript
   const canSplitMode = $derived(
     !isIPhoneOS || window.innerWidth >= 600
   );
   ```
   - `window.innerWidth < 600` æ—¶ Split æ¨¡å¼ä¸å¯é€‰
   - å½“å‰å¤„äº Split æ¨¡å¼ + æ—‹è½¬åˆ°ç«–å± â†’ è‡ªåŠ¨åˆ‡å› Visual æ¨¡å¼

2. **StatusBar æ¨¡å¼åˆ‡æ¢** â€” `src/lib/components/StatusBar.svelte`
   - iPhone ç«–å±ä¸‹ `modes` æ•°ç»„è¿‡æ»¤æ‰ `'split'`
   - æˆ–å°† Split æŒ‰é’®ç½®ç° + ä¸å¯ç‚¹å‡»

3. **æ¨ªå±æ¢å¤**
   - ç›‘å¬ `resize` äº‹ä»¶ï¼Œå®½åº¦æ¢å¤ â‰¥ 600px â†’ Split é‡æ–°å¯ç”¨
   - iPhone æ¨ªå±çº¦ 844pxï¼ˆiPhone 15ï¼‰ï¼ŒSplit å¯ç”¨

**ä¸å½±å“ç°æœ‰åŠŸèƒ½**ï¼š
- æ¡Œé¢ç«¯å’Œ iPad æ¨ªå±ä¸‹ `canSplitMode` å§‹ç»ˆä¸º `true`
- ä»… iPhone + ç«–å±æ—¶é™åˆ¶

**æ¶‰åŠæ–‡ä»¶**ï¼š
- `src/routes/+page.svelte` â€” Split æ¨¡å¼æ¡ä»¶æ§åˆ¶
- `src/lib/components/StatusBar.svelte` â€” æ¨¡å¼æŒ‰é’®è¿‡æ»¤

---

### F8.7 è§¦æ§ç›®æ ‡ä¸äº¤äº’ç²¾è°ƒ

**ç›®æ ‡**ï¼šç¡®ä¿æ‰€æœ‰å¯äº¤äº’å…ƒç´ åœ¨ iPhone ä¸Šæ»¡è¶³ Apple HIG 44pt æœ€å°è§¦æ§ç›®æ ‡ã€‚

**æ”¹é€ å†…å®¹**ï¼š

1. **TabBar å…³é—­æŒ‰é’®**
   - å½“å‰å…³é—­æŒ‰é’®ï¼ˆ`Ã—`ï¼‰å¯èƒ½åå°
   - iPhone ä¸Šå¢å¤§è§¦æ§çƒ­åŒºè‡³ 44Ã—44ptï¼ˆè§†è§‰å°ºå¯¸å¯ä¿æŒä¸å˜ï¼‰

2. **StatusBar æŒ‰é’®**
   - iPhone ä¸Š `--statusbar-height: 36px`
   - ç¡®ä¿æ¨¡å¼åˆ‡æ¢æŒ‰é’®ã€å‘å¸ƒæŒ‰é’®è§¦æ§åŒºåŸŸè¶³å¤Ÿ

3. **è¡¨å•è¾“å…¥**
   - Settings é¢æ¿ä¸­çš„ `<input>` / `<select>` é«˜åº¦ç¡®ä¿ â‰¥ 44pt
   - è‡ªåŠ¨èšç„¦é€‚é…ï¼ˆiOS ä¸å…è®¸éç”¨æˆ·è§¦å‘çš„ focusï¼‰

4. **é•¿æŒ‰ä¸Šä¸‹æ–‡èœå•**
   - v0.7.0 å·²ä¸º iPad é€‚é… `contextmenu` é•¿æŒ‰ï¼ŒiPhone å¤ç”¨
   - éªŒè¯ ProseMirror åœ¨ iPhone WKWebView ä¸­çš„é•¿æŒ‰è¡Œä¸º

**ä¸å½±å“ç°æœ‰åŠŸèƒ½**ï¼š
- è§¦æ§ç›®æ ‡è°ƒæ•´é€šè¿‡ `.platform-iphone` CSS éš”ç¦»
- ç°æœ‰æ¡Œé¢ç«¯å’Œ iPad ç«¯æ ·å¼ä¸å˜

**æ¶‰åŠæ–‡ä»¶**ï¼š
- `src/lib/components/TabBar.svelte` â€” å…³é—­æŒ‰é’®è§¦æ§çƒ­åŒº
- `src/lib/components/StatusBar.svelte` â€” æŒ‰é’®å°ºå¯¸
- `src/lib/components/SettingsPanel.svelte` â€” è¡¨å•è¾“å…¥é«˜åº¦

---

### F8.8 è™šæ‹Ÿé”®ç›˜ & Viewport æ‰©å±•

**ç›®æ ‡**ï¼šå°† v0.7.0 iPad è™šæ‹Ÿé”®ç›˜å¤„ç†æ‰©å±•åˆ° iPhoneã€‚

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š

1. **`isVirtualKeyboardVisible()` æ‰©å±•**
   - æ¡ä»¶ä» `!isIPadOS` æ”¹ä¸º `!isIOS`
   - iPhone å’Œ iPad å…±ç”¨ `visualViewport` ç›‘å¬é€»è¾‘

2. **`--app-height` å˜é‡**
   - v0.7.0 å·²å®ç° `visualViewport.onresize` â†’ åŠ¨æ€æ›´æ–° `--app-height`
   - æ¡ä»¶ä» `isTauri && isIPadOS` æ‰©å±•ä¸º `isTauri && isIOS`

3. **iPhone ç‰¹æœ‰é—®é¢˜**
   - iPhone é”®ç›˜é«˜åº¦é€šå¸¸æ¯” iPad æ›´å¤§ï¼ˆå å±å¹• ~50%ï¼‰
   - ç¼–è¾‘å™¨å¯è§†åŒºåŸŸå¯èƒ½ä»… ~300pxï¼Œéœ€ç¡®ä¿å…‰æ ‡è·Ÿéšæ»šåŠ¨
   - TouchToolbar åœ¨é”®ç›˜ä¸Šæ–¹æ˜¾ç¤ºï¼ˆå·²å®ç°ï¼Œå¤ç”¨ï¼‰

**ä¸å½±å“ç°æœ‰åŠŸèƒ½**ï¼š
- æ¡ä»¶ä» `isIPadOS` æ‰©å±•ä¸º `isIOS` æ˜¯è¶…é›†ï¼ŒiPad è¡Œä¸ºä¸å˜
- æ¡Œé¢ç«¯æ—  `visualViewport` ç›‘å¬ï¼Œä¸å—å½±å“

**æ¶‰åŠæ–‡ä»¶**ï¼š
- `src/lib/utils/platform.ts` â€” `isVirtualKeyboardVisible()` æ¡ä»¶æ‰©å±•
- `src/routes/+page.svelte` â€” `visualViewport` ç›‘å¬æ¡ä»¶æ‰©å±•

---

## æ–°å»ºæ–‡ä»¶æ¸…å•

| æ–‡ä»¶è·¯å¾„ | ç”¨é€” |
|---------|------|
| `src/lib/components/DrawerNavigation.svelte` | ç§»åŠ¨ç«¯æ–‡ä»¶æµè§ˆæŠ½å±‰ï¼ˆiPhone Sidebar æ›¿ä»£ï¼‰ |
| `src/lib/components/BottomSheet.svelte` | é€šç”¨åº•éƒ¨æŠ½å±‰ç»„ä»¶ï¼ˆAI é¢æ¿ã€Settings å¤ç”¨ï¼‰ |

## ä¿®æ”¹æ–‡ä»¶æ¸…å•

| æ–‡ä»¶è·¯å¾„ | æ”¹åŠ¨å†…å®¹ | å½±å“èŒƒå›´ |
|---------|---------|---------|
| `src/lib/utils/platform.ts` | æ–°å¢ `isIPhoneOS`ã€`isNarrowScreen()`ï¼Œæ‰©å±• `getPlatformClass()` | ä»…æ–°å¢å¯¼å‡ºï¼Œç°æœ‰å¯¼å‡ºä¸å˜ |
| `src/routes/+page.svelte` | Sidebar/Drawer æ¡ä»¶æ¸²æŸ“ï¼ŒAI é¢æ¿æ¡ä»¶æ¸²æŸ“ï¼ŒSplit ç¦ç”¨ï¼Œviewport æ‰©å±• | é€šè¿‡ `isIPhoneOS` éš”ç¦» |
| `src/lib/components/TitleBar.svelte` | æ·»åŠ æ±‰å ¡æŒ‰é’®ï¼ˆ`.platform-iphone` æ¡ä»¶æ˜¾ç¤ºï¼‰ | CSS éš”ç¦»ï¼Œä¸å½±å“æ¡Œé¢/iPad |
| `src/lib/components/StatusBar.svelte` | iPhone AI å…¥å£ã€æ¨¡å¼æŒ‰é’®è¿‡æ»¤ | CSS éš”ç¦» |
| `src/lib/components/ai/AIChatPanel.svelte` | iPhone å¸ƒå±€é€‚é…ï¼ˆBottomSheet åŒ…è£¹ï¼‰ | æ¡ä»¶åˆ†æ”¯éš”ç¦» |
| `src/lib/components/SettingsPanel.svelte` | iPhone å…¨å± Sheet å¸ƒå±€ | æ¡ä»¶åˆ†æ”¯éš”ç¦» |
| `src/lib/components/TabBar.svelte` | è§¦æ§çƒ­åŒºå¢å¤§ | CSS éš”ç¦» |
| `src/lib/styles/variables.css` | `.platform-iphone` å˜é‡è¦†ç›– | æ–°å¢ CSS classï¼Œä¸å½±å“ç°æœ‰ |
| `src/lib/styles/global.css` | `@media (max-width: 600px)` åª’ä½“æŸ¥è¯¢ | æ¡Œé¢ç«¯ä¸åŒ¹é… |
| `src-tauri/gen/apple/moraya_iOS/Info.plist` | `UIDeviceFamily: [1, 2]` | iPad æ„å»ºè¡Œä¸ºä¸å˜ï¼ˆè¶…é›†ï¼‰ |
| `src-tauri/gen/apple/project.yml` | `TARGETED_DEVICE_FAMILY: "1,2"` | iPad æ„å»ºè¡Œä¸ºä¸å˜ï¼ˆè¶…é›†ï¼‰ |

## Rust åç«¯ï¼šé›¶æ”¹åŠ¨

v0.7.0 å·²å®Œæˆçš„ iOS æ¡ä»¶ç¼–è¯‘å®Œå…¨è¦†ç›– iPhoneï¼š

```rust
// src-tauri/src/lib.rs â€” è¿™äº›æ¡ä»¶ç¼–è¯‘åŒæ—¶é€‚ç”¨äº iPad å’Œ iPhone
#[cfg(not(target_os = "ios"))]         // æ’é™¤ menuã€trayã€å¤šçª—å£
#[cfg(target_os = "macos")]            // macOS ä¸“å± dock æ¨¡å—
#[cfg(all(not(target_os = "macos"), not(target_os = "ios")))]  // trayï¼ˆä»…æ¡Œé¢ï¼‰
```

```rust
// src-tauri/src/commands/mcp.rs â€” stdio å·²åœ¨ iOS ä¸Šç¦ç”¨
#[cfg(not(target_os = "ios"))]
pub async fn mcp_connect_stdio(...) { /* ... */ }
```

æ— éœ€æ–°å¢ä»»ä½• Rust ä»£ç æˆ–æ¡ä»¶ç¼–è¯‘ã€‚

---

## CI/CD è‡ªåŠ¨åŒ–å‘å¸ƒ

### å‘å¸ƒæ¶æ„

```
git tag v* â†’ GitHub Actions release.yml
  â”œâ”€â”€ release (ç°æœ‰ï¼Œä¸å˜)
  â”‚   â”œâ”€â”€ macOS aarch64 â†’ DMG â†’ GitHub Releases
  â”‚   â”œâ”€â”€ macOS x86_64  â†’ DMG â†’ GitHub Releases
  â”‚   â”œâ”€â”€ Windows       â†’ MSI â†’ GitHub Releases
  â”‚   â””â”€â”€ Linux         â†’ DEB/AppImage â†’ GitHub Releases
  â”‚
  â”œâ”€â”€ release-ios (å¯ç”¨ï¼Œä» v0.7.0 æ³¨é‡Šæ€æ¢å¤)
  â”‚   â””â”€â”€ Universal iOS (iPad + iPhone)
  â”‚       â”œâ”€â”€ ç­¾å â†’ æ„å»º Universal IPA
  â”‚       â”œâ”€â”€ IPA â†’ GitHub Releasesï¼ˆå¤‡ä»½ä¸‹è½½ + ä¾§è½½ï¼‰
  â”‚       â””â”€â”€ IPA â†’ App Store Connect â†’ TestFlight â†’ App Store
  â”‚
  â””â”€â”€ trigger-deploy
      â””â”€â”€ needs: [release, release-ios] â†’ Cloudflare Pages
```

### ä¸ v0.7.0 CI çš„å·®å¼‚

| é¡¹ç›® | v0.7.0 (iPad only) | v0.8.0 (iPad + iPhone) |
|------|--------------------|-----------------------|
| `UIDeviceFamily` | `[2]` | `[1, 2]` |
| `TARGETED_DEVICE_FAMILY` | `"2"` | `"1,2"` |
| IPA äº§ç‰© | iPad-only | Universal (iPhone + iPad) |
| CI Job | `release-ios`ï¼ˆæ³¨é‡Šæ€ï¼‰ | `release-ios`ï¼ˆå¯ç”¨ï¼‰ |
| `trigger-deploy.needs` | `[release]`ï¼ˆä¸´æ—¶ï¼‰ | `[release, release-ios]` |
| App Store ä¸Šæ¶ | TestFlight only | TestFlight â†’ App Store æ­£å¼å‘å¸ƒ |

### Apple å¼€å‘è€…è´¦å·ä¸å¯†é’¥ç»Ÿä¸€

æ‰€æœ‰ iOS/macOS ç­¾åå…±ç”¨åŒä¸€ä¸ª Apple Developer è´¦å·ï¼ˆ$99/å¹´ï¼‰ï¼Œå¯†é’¥åˆ†å·¥å¦‚ä¸‹ï¼š

#### macOS ç­¾åï¼ˆå·²æœ‰ï¼Œæ¡Œé¢ç‰ˆä½¿ç”¨ï¼‰

| Secret åç§° | ç”¨é€” | çŠ¶æ€ |
|-------------|------|------|
| `APPLE_CERTIFICATE` | macOS Developer ID Certificate (.p12 base64) | å·²é…ç½®ï¼ˆæˆ–æ³¨é‡Šæ€ï¼‰ |
| `APPLE_CERTIFICATE_PASSWORD` | .p12 å¯¼å‡ºå¯†ç  | å·²é…ç½®ï¼ˆæˆ–æ³¨é‡Šæ€ï¼‰ |
| `APPLE_SIGNING_IDENTITY` | ç­¾åèº«ä»½ï¼ˆå¦‚ `Developer ID Application: Name (TEAMID)`ï¼‰ | å·²é…ç½®ï¼ˆæˆ–æ³¨é‡Šæ€ï¼‰ |
| `APPLE_ID` | Apple ID é‚®ç®±ï¼ˆå…¬è¯ç”¨ï¼‰ | å·²é…ç½®ï¼ˆæˆ–æ³¨é‡Šæ€ï¼‰ |
| `APPLE_PASSWORD` | App-specific passwordï¼ˆå…¬è¯ç”¨ï¼‰ | å·²é…ç½®ï¼ˆæˆ–æ³¨é‡Šæ€ï¼‰ |
| `APPLE_TEAM_ID` | Team IDï¼ˆ10 ä½å­—æ¯æ•°å­—ï¼‰ | å·²é…ç½®ï¼ˆæˆ–æ³¨é‡Šæ€ï¼‰ |

#### iOS ç­¾åï¼ˆv0.7.0 å·²å®šä¹‰ï¼Œv0.8.0 å¯ç”¨ï¼‰

| Secret åç§° | ç”¨é€” | ä¸ macOS çš„å…³ç³» |
|-------------|------|----------------|
| `IOS_CERTIFICATE_BASE64` | Apple Distribution Certificate (.p12 base64) | ä¸ macOS è¯ä¹¦ä¸åŒï¼Œä½†å±åŒä¸€è´¦å· |
| `IOS_CERTIFICATE_PASSWORD` | .p12 å¯¼å‡ºå¯†ç  | ç‹¬ç«‹å¯†ç  |
| `IOS_PROVISION_PROFILE_BASE64` | App Store Provisioning Profile (.mobileprovision base64) | ç»‘å®š Bundle ID `com.moraya.app` |

#### App Store Connect APIï¼ˆmacOS å…¬è¯ + iOS ä¸Šä¼ å…±ç”¨ï¼‰

| Secret åç§° | ç”¨é€” | å…±ç”¨è¯´æ˜ |
|-------------|------|---------|
| `APPSTORE_API_KEY_ID` | API Key IDï¼ˆå½¢å¦‚ `XXXXXXXXXX`ï¼‰ | macOS å…¬è¯å’Œ iOS ä¸Šä¼ å…±ç”¨åŒä¸€ Key |
| `APPSTORE_API_ISSUER` | API Issuer IDï¼ˆUUID æ ¼å¼ï¼‰ | åŒä¸€ Team å›ºå®šå€¼ |
| `APPSTORE_API_PRIVATE_KEY` | AuthKey .p8 æ–‡ä»¶å†…å®¹ | ä¸‹è½½åä»…å¯è§ä¸€æ¬¡ï¼Œå¦¥å–„ä¿ç®¡ |

#### å¯†é’¥è·å–æ­¥éª¤

```
1. Apple Developer Portal (developer.apple.com)
   â”œâ”€â”€ Certificates â†’ "+" â†’ Apple Distribution
   â”‚   â†’ ä¸‹è½½ .cer â†’ Keychain å¯¼å‡ºä¸º .p12 â†’ base64 ç¼–ç 
   â”‚   â†’ åŒæ—¶ç”¨äº iOS App ç­¾åå’Œ macOS App ç­¾å
   â”‚
   â”œâ”€â”€ Identifiers â†’ App IDs â†’ com.moraya.app
   â”‚   â†’ ç¡®ä¿å·²å­˜åœ¨ï¼ˆv0.7.0 åˆ›å»ºï¼‰ï¼ŒiPad + iPhone å…±ç”¨
   â”‚
   â”œâ”€â”€ Profiles â†’ "+" â†’ App Store â†’ é€‰æ‹© com.moraya.app
   â”‚   â†’ ä¸‹è½½ .mobileprovision â†’ base64 ç¼–ç 
   â”‚   â†’ é€‰æ‹© "iOS App Store" ç±»å‹ï¼ˆè¦†ç›– iPad + iPhoneï¼‰
   â”‚
   â””â”€â”€ App Store Connect â†’ Users and Access â†’ Keys
       â†’ "+" â†’ App Manager æƒé™ â†’ ä¸‹è½½ .p8
       â†’ è®°å½• Key ID å’Œ Issuer ID
       â†’ åŒä¸€ Key å¯ç”¨äº macOS å…¬è¯ + iOS ä¸Šä¼ 

2. GitHub Repository Settings â†’ Secrets and variables â†’ Actions
   â†’ æ·»åŠ ä¸Šè¿°æ‰€æœ‰ Secrets
```

### release-ios Job å®Œæ•´å®šä¹‰

v0.8.0 å¯ç”¨æ—¶ï¼Œå–æ¶ˆ `release.yml` ä¸­ `release-ios` çš„æ³¨é‡Šï¼Œå¹¶æ›´æ–°ä»¥ä¸‹å†…å®¹ï¼š

```yaml
release-ios:
  permissions:
    contents: write
  runs-on: macos-latest

  steps:
    - uses: actions/checkout@v4

    - name: Setup pnpm
      uses: pnpm/action-setup@v4
      with:
        version: 10

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: lts/*
        cache: pnpm

    - name: Install Rust stable
      uses: dtolnay/rust-toolchain@stable
      with:
        targets: aarch64-apple-ios

    - name: Rust cache
      uses: swatinem/rust-cache@v2
      with:
        workspaces: './src-tauri -> target'

    - name: Install frontend dependencies
      run: pnpm install --frozen-lockfile

    # å¯¼å…¥ç­¾åè¯ä¹¦åˆ° CI keychain
    - name: Install Apple certificate and provisioning profile
      env:
        IOS_CERTIFICATE_BASE64: ${{ secrets.IOS_CERTIFICATE_BASE64 }}
        IOS_CERTIFICATE_PASSWORD: ${{ secrets.IOS_CERTIFICATE_PASSWORD }}
        IOS_PROVISION_PROFILE_BASE64: ${{ secrets.IOS_PROVISION_PROFILE_BASE64 }}
      run: |
        KEYCHAIN_PATH=$RUNNER_TEMP/app-signing.keychain-db
        KEYCHAIN_PASSWORD=$(openssl rand -hex 12)
        security create-keychain -p "$KEYCHAIN_PASSWORD" $KEYCHAIN_PATH
        security set-keychain-settings -lut 21600 $KEYCHAIN_PATH
        security unlock-keychain -p "$KEYCHAIN_PASSWORD" $KEYCHAIN_PATH

        CERT_PATH=$RUNNER_TEMP/certificate.p12
        echo -n "$IOS_CERTIFICATE_BASE64" | base64 --decode -o $CERT_PATH
        security import $CERT_PATH -P "$IOS_CERTIFICATE_PASSWORD" \
          -A -t cert -f pkcs12 -k $KEYCHAIN_PATH
        security set-key-partition-list -S apple-tool:,apple: \
          -k "$KEYCHAIN_PASSWORD" $KEYCHAIN_PATH
        security list-keychain -d user -s $KEYCHAIN_PATH

        PROFILE_PATH=$RUNNER_TEMP/profile.mobileprovision
        echo -n "$IOS_PROVISION_PROFILE_BASE64" | base64 --decode -o $PROFILE_PATH
        mkdir -p ~/Library/MobileDevice/Provisioning\ Profiles
        cp $PROFILE_PATH ~/Library/MobileDevice/Provisioning\ Profiles/

    # è®¾ç½®æ„å»ºå·ï¼ˆè‡ªå¢ï¼Œæ¯æ¬¡ CI é€’å¢ï¼‰
    - name: Set iOS build number
      run: |
        cd src-tauri/gen/apple
        agvtool new-version -all ${{ github.run_number }}

    # æ„å»º Universal IPAï¼ˆiPad + iPhoneï¼‰
    - name: Build iOS
      run: pnpm tauri ios build

    # IPA ä¸Šä¼ åˆ° GitHub Releaseï¼ˆä¸æ¡Œé¢åŒ…åŒä¸€ä¸ª Releaseï¼‰
    - name: Upload IPA to GitHub Release
      uses: softprops/action-gh-release@v2
      with:
        files: src-tauri/gen/apple/build/arm64/Moraya.ipa
        tag_name: ${{ github.ref_name }}
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    # ä¸Šä¼ åˆ° App Store Connect â†’ è‡ªåŠ¨è¿›å…¥ TestFlight
    - name: Upload to App Store Connect
      env:
        APPSTORE_API_KEY_ID: ${{ secrets.APPSTORE_API_KEY_ID }}
        APPSTORE_API_ISSUER: ${{ secrets.APPSTORE_API_ISSUER }}
        APPSTORE_API_PRIVATE_KEY: ${{ secrets.APPSTORE_API_PRIVATE_KEY }}
      run: |
        mkdir -p ~/.appstoreconnect/private_keys
        echo "$APPSTORE_API_PRIVATE_KEY" > \
          ~/.appstoreconnect/private_keys/AuthKey_${APPSTORE_API_KEY_ID}.p8

        xcrun altool --upload-app \
          --type ios \
          --file "src-tauri/gen/apple/build/arm64/Moraya.ipa" \
          --apiKey "$APPSTORE_API_KEY_ID" \
          --apiIssuer "$APPSTORE_API_ISSUER"

    # æ¸…ç† keychain
    - name: Cleanup
      if: always()
      run: |
        security delete-keychain $RUNNER_TEMP/app-signing.keychain-db || true
        rm -f $RUNNER_TEMP/certificate.p12 $RUNNER_TEMP/profile.mobileprovision
```

### trigger-deploy æ›´æ–°

```yaml
trigger-deploy:
  needs: [release, release-ios]  # æ¢å¤ç­‰å¾… iOS æ„å»º
  runs-on: ubuntu-latest
  steps:
    - name: Trigger Cloudflare Pages Deploy
      run: |
        curl -X POST "${{ secrets.CLOUDFLARE_DEPLOY_HOOK_URL }}"
```

### Release Notes æ¨¡æ¿æ›´æ–°

```markdown
### iOS (iPad + iPhone)

Available on TestFlight. [Join Beta â†’](https://testflight.apple.com/join/XXXXX)

Or download the `.ipa` file below for Ad Hoc sideloading.
```

### æ„å»ºå·ç®¡ç†

| å­—æ®µ | å€¼ | è¯´æ˜ |
|------|-----|------|
| `CFBundleShortVersionString` | `0.8.0` | æ¥è‡ª `tauri.conf.json` version |
| `CFBundleVersion` | `${{ github.run_number }}` | CI æ¯æ¬¡è‡ªå¢ï¼ˆå¦‚ 42, 43, 44...ï¼‰ |

åŒä¸€ç‰ˆæœ¬å·å¯å¤šæ¬¡ä¸Šä¼ ï¼ˆæ„å»ºå·ä¸åŒï¼‰ï¼ŒTestFlight è‡ªåŠ¨æ˜¾ç¤ºæœ€æ–°æ„å»ºã€‚

### å‘å¸ƒæµç¨‹

ä¸æ¡Œé¢ç«¯å®Œå…¨ç»Ÿä¸€ï¼Œæ— éœ€é¢å¤–æ“ä½œï¼š

```bash
pnpm version:bump 0.8.0
git add -A && git commit -m "chore: release v0.8.0"
git tag v0.8.0
git push origin main --tags
# GitHub Actions è‡ªåŠ¨å®Œæˆï¼š
#   â†’ macOS DMG + Windows MSI + Linux DEB â†’ GitHub Releases
#   â†’ Universal IPA (iPad + iPhone) â†’ GitHub Releases + App Store Connect â†’ TestFlight
#   â†’ Cloudflare Pages éƒ¨ç½²
```

### ç”¨æˆ·å®‰è£…æ–¹å¼

| å¹³å° | å®‰è£…æ–¹å¼ | å®‰å…¨é—®é¢˜ |
|------|---------|---------|
| macOS | ä¸‹è½½ DMG â†’ æ‹–å…¥ Applications | éœ€ `xattr -cr`ï¼ˆæœªå…¬è¯æ—¶ï¼‰ |
| Windows | ä¸‹è½½ MSI â†’ åŒå‡»å®‰è£… | SmartScreen è­¦å‘Šï¼ˆæœªç­¾åæ—¶ï¼‰ |
| Linux | `dpkg -i .deb` æˆ–è¿è¡Œ `.AppImage` | æ—  |
| **iPad** | **TestFlight / App Store** | **æ— ï¼ˆè‹¹æœç­¾åéªŒè¯ï¼‰** |
| **iPhone** | **TestFlight / App Store** | **æ— ï¼ˆè‹¹æœç­¾åéªŒè¯ï¼‰** |

---

## å®æ–½é¡ºåº

| é˜¶æ®µ | åŠŸèƒ½ | é¢„ä¼°å·¥ä½œé‡ | å‰ç½®æ¡ä»¶ |
|------|------|-----------|---------|
| Phase 1 | F8.1 å¹³å°æ£€æµ‹ + è®¾å¤‡ç›®æ ‡ | 1-2 å¤© | æ—  |
| Phase 2 | F8.2 CSS å˜é‡ + æ–­ç‚¹ | 1-2 å¤© | Phase 1 |
| Phase 3 | F8.3 Sidebar æŠ½å±‰ | 2-3 å¤© | Phase 2 |
| Phase 4 | F8.4 AI é¢æ¿åº•éƒ¨æŠ½å±‰ | 2-3 å¤© | Phase 2ï¼ˆBottomSheetï¼‰ |
| Phase 5 | F8.5 Settings å…¨å± Sheet | 1-2 å¤© | Phase 4ï¼ˆå¤ç”¨ BottomSheetï¼‰ |
| Phase 6 | F8.6 Split æ¨¡å¼ç¦ç”¨ | 0.5-1 å¤© | Phase 1 |
| Phase 7 | F8.7 è§¦æ§ç›®æ ‡ç²¾è°ƒ | 1-2 å¤© | Phase 3-5 |
| Phase 8 | F8.8 è™šæ‹Ÿé”®ç›˜æ‰©å±• | 0.5-1 å¤© | Phase 1 |
| Phase 9 | CI/CD å¯ç”¨ + æµ‹è¯• | 1-2 å¤© | Phase 1-8 |
| **åˆè®¡** | | **10-18 å¤©** | |

---

## æµ‹è¯•æ–¹æ¡ˆ

### ç¯å¢ƒå‡†å¤‡

| é¡¹ç›® | è¦æ±‚ |
|------|------|
| macOS | å¿…é¡»ï¼ˆiOS å¼€å‘åªèƒ½åœ¨ Mac ä¸Šï¼‰ |
| Xcode | æœ€æ–°ç‰ˆï¼ˆå« iOS SDKã€iPhone + iPad æ¨¡æ‹Ÿå™¨ï¼‰ |
| Rust iOS targets | `aarch64-apple-ios` + `aarch64-apple-ios-sim`ï¼ˆv0.7.0 å·²å®‰è£…ï¼‰ |
| Apple å¼€å‘è€…è´¦å· | ä»˜è´¹è´¦å·ï¼ˆ$99/å¹´ï¼‰ï¼Œä¸ macOS ç­¾åå…±ç”¨ |

### æµè§ˆå™¨å¿«é€ŸéªŒè¯

```bash
# iPhone æ¨¡å¼ï¼ˆæ— éœ€ Xcodeï¼‰
pnpm dev
# è®¿é—® http://localhost:5173/?iphone=1
# éªŒè¯ï¼šå¹³å°æ£€æµ‹ã€Drawer å¯¼èˆªã€BottomSheetã€Split ç¦ç”¨
```

### æ¨¡æ‹Ÿå™¨æµ‹è¯•

```bash
# iPhone æ¨¡æ‹Ÿå™¨
pnpm tauri ios dev "iPhone 15"
pnpm tauri ios dev "iPhone 15 Pro Max"
pnpm tauri ios dev "iPhone SE (3rd generation)"  # æœ€å°å±

# iPad æ¨¡æ‹Ÿå™¨ï¼ˆå›å½’éªŒè¯ï¼‰
pnpm tauri ios dev "iPad Air"
```

### åˆ†é˜¶æ®µæµ‹è¯•æ£€æŸ¥è¡¨

#### Phase 1-2ï¼šåŸºç¡€æ„å»º + CSSï¼ˆæ¨¡æ‹Ÿå™¨ï¼‰

```
[ ] iPhone æ¨¡æ‹Ÿå™¨å¯åŠ¨æˆåŠŸï¼Œä¸ crash
[ ] `document.body.classList` åŒ…å« `platform-iphone`
[ ] `?iphone=1` æµè§ˆå™¨æµ‹è¯•æ¨¡å¼æ­£å¸¸å·¥ä½œ
[ ] iPad æ¨¡æ‹Ÿå™¨å›å½’ï¼šä¸å—å½±å“ï¼Œä»ä¸º `platform-ipados`
[ ] æ¡Œé¢ç«¯å›å½’ï¼š`pnpm tauri dev` åŠŸèƒ½æ­£å¸¸
[ ] pnpm check TypeScript é›¶é”™è¯¯
```

#### Phase 3ï¼šSidebar æŠ½å±‰ï¼ˆæ¨¡æ‹Ÿå™¨ï¼‰

```
[ ] TitleBar æ˜¾ç¤ºæ±‰å ¡èœå•æŒ‰é’®ï¼ˆä»… iPhoneï¼‰
[ ] ç‚¹å‡»æ±‰å ¡ â†’ æŠ½å±‰ä»å·¦ä¾§æ»‘å…¥
[ ] æŠ½å±‰å†…æ–‡ä»¶æ ‘æ­£å¸¸æ˜¾ç¤º
[ ] ç‚¹å‡»æ–‡ä»¶ â†’ æŠ½å±‰å…³é—­ + æ–‡ä»¶åœ¨ Tab ä¸­æ‰“å¼€
[ ] ç‚¹å‡»é®ç½© â†’ æŠ½å±‰å…³é—­
[ ] iPad å›å½’ï¼šSidebar ä»ä¸ºå¸¸é©»ä¾§è¾¹æ ï¼ˆæ— æ±‰å ¡æŒ‰é’®ï¼‰
[ ] æ¡Œé¢å›å½’ï¼šSidebar ä¸å—å½±å“
```

#### Phase 4-5ï¼šAI é¢æ¿ + Settingsï¼ˆæ¨¡æ‹Ÿå™¨ï¼‰

```
[ ] StatusBar æ˜¾ç¤º AI å…¥å£æŒ‰é’®ï¼ˆä»… iPhoneï¼‰
[ ] ç‚¹å‡» AI æŒ‰é’® â†’ åº•éƒ¨æŠ½å±‰å¼¹å‡º
[ ] AI å¯¹è¯åŠŸèƒ½æ­£å¸¸ï¼ˆè¾“å…¥ã€æµå¼å“åº”ï¼‰
[ ] ä¸‹æ‹‰æŠ½å±‰ â†’ å…³é—­
[ ] Settings â†’ å…¨å± Sheet æ‰“å¼€
[ ] Settings Tab æ å¯æ¨ªå‘æ»šåŠ¨
[ ] iPad å›å½’ï¼šAI é¢æ¿ä»ä¸ºå³ä¾§æ 
[ ] æ¡Œé¢å›å½’ï¼šSettings ä»ä¸ºæ¨¡æ€å¼¹çª—
```

#### Phase 6ï¼šSplit æ¨¡å¼ï¼ˆæ¨¡æ‹Ÿå™¨ï¼‰

```
[ ] iPhone ç«–å±ï¼šStatusBar æ—  Split é€‰é¡¹
[ ] iPhone æ¨ªå±ï¼ˆæ—‹è½¬ï¼‰ï¼šSplit é€‰é¡¹æ¢å¤
[ ] ä»æ¨ªå± Split â†’ æ—‹è½¬åˆ°ç«–å± â†’ è‡ªåŠ¨åˆ‡å› Visual
[ ] iPad å›å½’ï¼šSplit æ¨¡å¼ä¸å—å½±å“
```

#### Phase 7-8ï¼šè§¦æ§ + é”®ç›˜ï¼ˆå¿…é¡»çœŸæœºï¼‰

```
[ ] æ‰€æœ‰æŒ‰é’®è§¦æ§åŒºåŸŸ â‰¥ 44pt
[ ] è™šæ‹Ÿé”®ç›˜å¼¹å‡º â†’ TouchToolbar æ˜¾ç¤ºåœ¨é”®ç›˜ä¸Šæ–¹
[ ] é”®ç›˜å¼¹å‡º â†’ ç¼–è¾‘å™¨é«˜åº¦è‡ªåŠ¨ç¼©å‡
[ ] é”®ç›˜æ”¶èµ· â†’ å¸ƒå±€æ¢å¤æ­£å¸¸
[ ] æ‰“å­—æ—¶å…‰æ ‡å§‹ç»ˆåœ¨å¯è§†åŒºåŸŸå†…
[ ] iPhone é”®ç›˜ï¼ˆå å± ~50%ï¼‰â†’ ç¼–è¾‘å™¨ä»å¯æ­£å¸¸ä½¿ç”¨
```

#### Phase 9ï¼šCI/CDï¼ˆGitHub Actionsï¼‰

```
[ ] release-ios Job å¯ç”¨ï¼Œä¸ release Job å¹¶è¡Œæ‰§è¡Œ
[ ] Universal IPA æ„å»ºæˆåŠŸ
[ ] IPA ä¸Šä¼ åˆ° GitHub Releases
[ ] IPA ä¸Šä¼ åˆ° App Store Connect
[ ] TestFlight ä¸­åŒæ—¶å‡ºç° iPhone å’Œ iPad å¯ç”¨
[ ] trigger-deploy ç­‰å¾… release + release-ios å®Œæˆåè§¦å‘
[ ] æ¡Œé¢æ„å»ºï¼ˆmacOS/Windows/Linuxï¼‰ä¸å—å½±å“
```

#### æœ€ç»ˆå›å½’æ£€æŸ¥

```
[ ] macOS æ¡Œé¢ï¼špnpm tauri dev åŠŸèƒ½æ­£å¸¸
[ ] Windows æ¡Œé¢ï¼šæ‰€æœ‰åŠŸèƒ½æ­£å¸¸
[ ] iPad æ¨¡æ‹Ÿå™¨ï¼šv0.7.0 æ‰€æœ‰åŠŸèƒ½æ­£å¸¸ï¼ˆTabã€TouchToolbarã€Sidebar ç­‰ï¼‰
[ ] iPhone æ¨¡æ‹Ÿå™¨ï¼šæ‰€æœ‰æ–°åŠŸèƒ½æ­£å¸¸
[ ] iPhone çœŸæœºï¼šè§¦æ§ã€é”®ç›˜ã€æ¨ªç«–å±æ—‹è½¬
```

### è®¾å¤‡è¦†ç›–çŸ©é˜µ

| è®¾å¤‡ | å±å¹•å®½åº¦ï¼ˆç«–å±ï¼‰ | æµ‹è¯•é‡ç‚¹ |
|------|----------------|---------|
| iPhone SE 3rd | 375px | æœ€çª„å±å¹•ï¼ŒéªŒè¯æœ€å°å¸ƒå±€ |
| iPhone 15 | 393px | ä¸»æµæœºå‹ |
| iPhone 15 Pro Max | 430px | æœ€å®½ iPhoneï¼ŒéªŒè¯å¤§å±å¸ƒå±€ |
| iPhone 15ï¼ˆæ¨ªå±ï¼‰ | 852px | æ¨ªå± Split æ¨¡å¼ |
| iPad Airï¼ˆå›å½’ï¼‰ | 820px+ | ç¡®ä¿ iPad åŠŸèƒ½ä¸å—å½±å“ |
